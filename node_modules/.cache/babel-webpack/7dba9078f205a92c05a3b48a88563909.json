{"ast":null,"code":"import firebase from '@firebase/app';\nimport { __awaiter, __generator, __spreadArrays } from 'tslib';\nimport { Component } from '@firebase/component';\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @fileoverview Constants used in the Firebase Storage library.\r\n */\n\n/**\r\n * Domain name for firebase storage.\r\n */\n\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\n/**\r\n * The key in Firebase config json for the storage bucket.\r\n */\n\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\n/**\r\n * 2 minutes\r\n *\r\n * The timeout for all operations except upload.\r\n */\n\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\n/**\r\n * 10 minutes\r\n *\r\n * The timeout for upload.\r\n */\n\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar FirebaseStorageError =\n/** @class */\nfunction () {\n  function FirebaseStorageError(code, message) {\n    this.code_ = prependCode(code);\n    this.message_ = 'Firebase Storage: ' + message;\n    this.serverResponse_ = null;\n    this.name_ = 'FirebaseError';\n  }\n\n  FirebaseStorageError.prototype.codeProp = function () {\n    return this.code;\n  };\n\n  FirebaseStorageError.prototype.codeEquals = function (code) {\n    return prependCode(code) === this.codeProp();\n  };\n\n  FirebaseStorageError.prototype.serverResponseProp = function () {\n    return this.serverResponse_;\n  };\n\n  FirebaseStorageError.prototype.setServerResponseProp = function (serverResponse) {\n    this.serverResponse_ = serverResponse;\n  };\n\n  Object.defineProperty(FirebaseStorageError.prototype, \"name\", {\n    get: function () {\n      return this.name_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FirebaseStorageError.prototype, \"code\", {\n    get: function () {\n      return this.code_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\n    get: function () {\n      if (this.serverResponse_) {\n        return this.message_ + '\\n' + this.serverResponse_;\n      } else {\n        return this.message_;\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\n    get: function () {\n      return this.serverResponse_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return FirebaseStorageError;\n}();\n\nvar Code = {\n  // Shared between all platforms\n  UNKNOWN: 'unknown',\n  OBJECT_NOT_FOUND: 'object-not-found',\n  BUCKET_NOT_FOUND: 'bucket-not-found',\n  PROJECT_NOT_FOUND: 'project-not-found',\n  QUOTA_EXCEEDED: 'quota-exceeded',\n  UNAUTHENTICATED: 'unauthenticated',\n  UNAUTHORIZED: 'unauthorized',\n  RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\n  INVALID_CHECKSUM: 'invalid-checksum',\n  CANCELED: 'canceled',\n  // JS specific\n  INVALID_EVENT_NAME: 'invalid-event-name',\n  INVALID_URL: 'invalid-url',\n  INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\n  NO_DEFAULT_BUCKET: 'no-default-bucket',\n  CANNOT_SLICE_BLOB: 'cannot-slice-blob',\n  SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\n  NO_DOWNLOAD_URL: 'no-download-url',\n  INVALID_ARGUMENT: 'invalid-argument',\n  INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\n  APP_DELETED: 'app-deleted',\n  INVALID_ROOT_OPERATION: 'invalid-root-operation',\n  INVALID_FORMAT: 'invalid-format',\n  INTERNAL_ERROR: 'internal-error'\n};\n\nfunction prependCode(code) {\n  return 'storage/' + code;\n}\n\nfunction unknown() {\n  var message = 'An unknown error occurred, please check the error payload for ' + 'server response.';\n  return new FirebaseStorageError(Code.UNKNOWN, message);\n}\n\nfunction objectNotFound(path) {\n  return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\n}\n\nfunction quotaExceeded(bucket) {\n  return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" + bucket + \"' exceeded, please view quota on \" + 'https://firebase.google.com/pricing/.');\n}\n\nfunction unauthenticated() {\n  var message = 'User is not authenticated, please authenticate using Firebase ' + 'Authentication and try again.';\n  return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\n}\n\nfunction unauthorized(path) {\n  return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\n}\n\nfunction retryLimitExceeded() {\n  return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\n}\n\nfunction canceled() {\n  return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\n}\n\nfunction invalidUrl(url) {\n  return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\n}\n\nfunction invalidDefaultBucket(bucket) {\n  return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\n}\n\nfunction cannotSliceBlob() {\n  return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\n}\n\nfunction serverFileWrongSize() {\n  return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\n}\n\nfunction noDownloadURL() {\n  return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\n}\n\nfunction invalidArgument(index, fnName, message) {\n  return new FirebaseStorageError(Code.INVALID_ARGUMENT, 'Invalid argument in `' + fnName + '` at index ' + index + ': ' + message);\n}\n\nfunction invalidArgumentCount(argMin, argMax, fnName, real) {\n  var countPart;\n  var plural;\n\n  if (argMin === argMax) {\n    countPart = argMin;\n    plural = argMin === 1 ? 'argument' : 'arguments';\n  } else {\n    countPart = 'between ' + argMin + ' and ' + argMax;\n    plural = 'arguments';\n  }\n\n  return new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT, 'Invalid argument count in `' + fnName + '`: Expected ' + countPart + ' ' + plural + ', received ' + real + '.');\n}\n\nfunction appDeleted() {\n  return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\n}\n/**\r\n * @param name The name of the operation that was invalid.\r\n */\n\n\nfunction invalidRootOperation(name) {\n  return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" + name + \"' cannot be performed on a root reference, create a non-root \" + \"reference using child, such as .child('file.png').\");\n}\n/**\r\n * @param format The format that was not valid.\r\n * @param message A message describing the format violation.\r\n */\n\n\nfunction invalidFormat(format, message) {\n  return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\n}\n/**\r\n * @param message A message describing the internal error.\r\n */\n\n\nfunction internalError(message) {\n  throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar StringFormat = {\n  RAW: 'raw',\n  BASE64: 'base64',\n  BASE64URL: 'base64url',\n  DATA_URL: 'data_url'\n};\n\nfunction formatValidator(stringFormat) {\n  switch (stringFormat) {\n    case StringFormat.RAW:\n    case StringFormat.BASE64:\n    case StringFormat.BASE64URL:\n    case StringFormat.DATA_URL:\n      return;\n\n    default:\n      throw 'Expected one of the event types: [' + StringFormat.RAW + ', ' + StringFormat.BASE64 + ', ' + StringFormat.BASE64URL + ', ' + StringFormat.DATA_URL + '].';\n  }\n}\n/**\r\n * @struct\r\n */\n\n\nvar StringData =\n/** @class */\nfunction () {\n  function StringData(data, contentType) {\n    this.data = data;\n    this.contentType = contentType || null;\n  }\n\n  return StringData;\n}();\n\nfunction dataFromString(format, stringData) {\n  switch (format) {\n    case StringFormat.RAW:\n      return new StringData(utf8Bytes_(stringData));\n\n    case StringFormat.BASE64:\n    case StringFormat.BASE64URL:\n      return new StringData(base64Bytes_(format, stringData));\n\n    case StringFormat.DATA_URL:\n      return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\n    // do nothing\n  } // assert(false);\n\n\n  throw unknown();\n}\n\nfunction utf8Bytes_(value) {\n  var b = [];\n\n  for (var i = 0; i < value.length; i++) {\n    var c = value.charCodeAt(i);\n\n    if (c <= 127) {\n      b.push(c);\n    } else {\n      if (c <= 2047) {\n        b.push(192 | c >> 6, 128 | c & 63);\n      } else {\n        if ((c & 64512) === 55296) {\n          // The start of a surrogate pair.\n          var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\n\n          if (!valid) {\n            // The second surrogate wasn't there.\n            b.push(239, 191, 189);\n          } else {\n            var hi = c;\n            var lo = value.charCodeAt(++i);\n            c = 65536 | (hi & 1023) << 10 | lo & 1023;\n            b.push(240 | c >> 18, 128 | c >> 12 & 63, 128 | c >> 6 & 63, 128 | c & 63);\n          }\n        } else {\n          if ((c & 64512) === 56320) {\n            // Invalid low surrogate.\n            b.push(239, 191, 189);\n          } else {\n            b.push(224 | c >> 12, 128 | c >> 6 & 63, 128 | c & 63);\n          }\n        }\n      }\n    }\n  }\n\n  return new Uint8Array(b);\n}\n\nfunction percentEncodedBytes_(value) {\n  var decoded;\n\n  try {\n    decoded = decodeURIComponent(value);\n  } catch (e) {\n    throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\n  }\n\n  return utf8Bytes_(decoded);\n}\n\nfunction base64Bytes_(format, value) {\n  switch (format) {\n    case StringFormat.BASE64:\n      {\n        var hasMinus = value.indexOf('-') !== -1;\n        var hasUnder = value.indexOf('_') !== -1;\n\n        if (hasMinus || hasUnder) {\n          var invalidChar = hasMinus ? '-' : '_';\n          throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64url encoded?\");\n        }\n\n        break;\n      }\n\n    case StringFormat.BASE64URL:\n      {\n        var hasPlus = value.indexOf('+') !== -1;\n        var hasSlash = value.indexOf('/') !== -1;\n\n        if (hasPlus || hasSlash) {\n          var invalidChar = hasPlus ? '+' : '/';\n          throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\n        }\n\n        value = value.replace(/-/g, '+').replace(/_/g, '/');\n        break;\n      }\n    // do nothing\n  }\n\n  var bytes;\n\n  try {\n    bytes = atob(value);\n  } catch (e) {\n    throw invalidFormat(format, 'Invalid character found');\n  }\n\n  var array = new Uint8Array(bytes.length);\n\n  for (var i = 0; i < bytes.length; i++) {\n    array[i] = bytes.charCodeAt(i);\n  }\n\n  return array;\n}\n/**\r\n * @struct\r\n */\n\n\nvar DataURLParts =\n/** @class */\nfunction () {\n  function DataURLParts(dataURL) {\n    this.base64 = false;\n    this.contentType = null;\n    var matches = dataURL.match(/^data:([^,]+)?,/);\n\n    if (matches === null) {\n      throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\n    }\n\n    var middle = matches[1] || null;\n\n    if (middle != null) {\n      this.base64 = endsWith(middle, ';base64');\n      this.contentType = this.base64 ? middle.substring(0, middle.length - ';base64'.length) : middle;\n    }\n\n    this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\n  }\n\n  return DataURLParts;\n}();\n\nfunction dataURLBytes_(dataUrl) {\n  var parts = new DataURLParts(dataUrl);\n\n  if (parts.base64) {\n    return base64Bytes_(StringFormat.BASE64, parts.rest);\n  } else {\n    return percentEncodedBytes_(parts.rest);\n  }\n}\n\nfunction dataURLContentType_(dataUrl) {\n  var parts = new DataURLParts(dataUrl);\n  return parts.contentType;\n}\n\nfunction endsWith(s, end) {\n  var longEnough = s.length >= end.length;\n\n  if (!longEnough) {\n    return false;\n  }\n\n  return s.substring(s.length - end.length) === end;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar TaskEvent = {\n  /** Triggered whenever the task changes or progress is updated. */\n  STATE_CHANGED: 'state_changed'\n};\nvar InternalTaskState = {\n  RUNNING: 'running',\n  PAUSING: 'pausing',\n  PAUSED: 'paused',\n  SUCCESS: 'success',\n  CANCELING: 'canceling',\n  CANCELED: 'canceled',\n  ERROR: 'error'\n};\nvar TaskState = {\n  /** The task is currently transferring data. */\n  RUNNING: 'running',\n\n  /** The task was paused by the user. */\n  PAUSED: 'paused',\n\n  /** The task completed successfully. */\n  SUCCESS: 'success',\n\n  /** The task was canceled. */\n  CANCELED: 'canceled',\n\n  /** The task failed with an error. */\n  ERROR: 'error'\n};\n\nfunction taskStateFromInternalTaskState(state) {\n  switch (state) {\n    case InternalTaskState.RUNNING:\n    case InternalTaskState.PAUSING:\n    case InternalTaskState.CANCELING:\n      return TaskState.RUNNING;\n\n    case InternalTaskState.PAUSED:\n      return TaskState.PAUSED;\n\n    case InternalTaskState.SUCCESS:\n      return TaskState.SUCCESS;\n\n    case InternalTaskState.CANCELED:\n      return TaskState.CANCELED;\n\n    case InternalTaskState.ERROR:\n      return TaskState.ERROR;\n\n    default:\n      // TODO(andysoto): assert(false);\n      return TaskState.ERROR;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @return False if the object is undefined or null, true otherwise.\r\n */\n\n\nfunction isDef(p) {\n  return p != null;\n}\n\nfunction isJustDef(p) {\n  return p !== void 0;\n} // eslint-disable-next-line @typescript-eslint/ban-types\n\n\nfunction isFunction(p) {\n  return typeof p === 'function';\n}\n\nfunction isObject(p) {\n  return typeof p === 'object';\n}\n\nfunction isNonNullObject(p) {\n  return isObject(p) && p !== null;\n}\n\nfunction isNonArrayObject(p) {\n  return isObject(p) && !Array.isArray(p);\n}\n\nfunction isString(p) {\n  return typeof p === 'string' || p instanceof String;\n}\n\nfunction isInteger(p) {\n  return isNumber(p) && Number.isInteger(p);\n}\n\nfunction isNumber(p) {\n  return typeof p === 'number' || p instanceof Number;\n}\n\nfunction isNativeBlob(p) {\n  return isNativeBlobDefined() && p instanceof Blob;\n}\n\nfunction isNativeBlobDefined() {\n  return typeof Blob !== 'undefined';\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @enum{number}\r\n */\n\n\nvar ErrorCode;\n\n(function (ErrorCode) {\n  ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\n  ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\n  ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\n})(ErrorCode || (ErrorCode = {}));\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n * doesn't work in React Native on Android.\r\n */\n\n\nvar NetworkXhrIo =\n/** @class */\nfunction () {\n  function NetworkXhrIo() {\n    var _this = this;\n\n    this.sent_ = false;\n    this.xhr_ = new XMLHttpRequest();\n    this.errorCode_ = ErrorCode.NO_ERROR;\n    this.sendPromise_ = new Promise(function (resolve) {\n      _this.xhr_.addEventListener('abort', function () {\n        _this.errorCode_ = ErrorCode.ABORT;\n        resolve(_this);\n      });\n\n      _this.xhr_.addEventListener('error', function () {\n        _this.errorCode_ = ErrorCode.NETWORK_ERROR;\n        resolve(_this);\n      });\n\n      _this.xhr_.addEventListener('load', function () {\n        resolve(_this);\n      });\n    });\n  }\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.send = function (url, method, body, headers) {\n    if (this.sent_) {\n      throw internalError('cannot .send() more than once');\n    }\n\n    this.sent_ = true;\n    this.xhr_.open(method, url, true);\n\n    if (isDef(headers)) {\n      for (var key in headers) {\n        if (headers.hasOwnProperty(key)) {\n          this.xhr_.setRequestHeader(key, headers[key].toString());\n        }\n      }\n    }\n\n    if (isDef(body)) {\n      this.xhr_.send(body);\n    } else {\n      this.xhr_.send();\n    }\n\n    return this.sendPromise_;\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.getErrorCode = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getErrorCode() before sending');\n    }\n\n    return this.errorCode_;\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.getStatus = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getStatus() before sending');\n    }\n\n    try {\n      return this.xhr_.status;\n    } catch (e) {\n      return -1;\n    }\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.getResponseText = function () {\n    if (!this.sent_) {\n      throw internalError('cannot .getResponseText() before sending');\n    }\n\n    return this.xhr_.responseText;\n  };\n  /**\r\n   * Aborts the request.\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.abort = function () {\n    this.xhr_.abort();\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.getResponseHeader = function (header) {\n    return this.xhr_.getResponseHeader(header);\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\n    if (isDef(this.xhr_.upload)) {\n      this.xhr_.upload.addEventListener('progress', listener);\n    }\n  };\n  /**\r\n   * @override\r\n   */\n\n\n  NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\n    if (isDef(this.xhr_.upload)) {\n      this.xhr_.upload.removeEventListener('progress', listener);\n    }\n  };\n\n  return NetworkXhrIo;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Factory-like class for creating XhrIo instances.\r\n */\n\n\nvar XhrIoPool =\n/** @class */\nfunction () {\n  function XhrIoPool() {}\n\n  XhrIoPool.prototype.createXhrIo = function () {\n    return new NetworkXhrIo();\n  };\n\n  return XhrIoPool;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getBlobBuilder() {\n  if (typeof BlobBuilder !== 'undefined') {\n    return BlobBuilder;\n  } else if (typeof WebKitBlobBuilder !== 'undefined') {\n    return WebKitBlobBuilder;\n  } else {\n    return undefined;\n  }\n}\n/**\r\n * Concatenates one or more values together and converts them to a Blob.\r\n *\r\n * @param args The values that will make up the resulting blob.\r\n * @return The blob.\r\n */\n\n\nfunction getBlob() {\n  var args = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    args[_i] = arguments[_i];\n  }\n\n  var BlobBuilder = getBlobBuilder();\n\n  if (BlobBuilder !== undefined) {\n    var bb = new BlobBuilder();\n\n    for (var i = 0; i < args.length; i++) {\n      bb.append(args[i]);\n    }\n\n    return bb.getBlob();\n  } else {\n    if (isNativeBlobDefined()) {\n      return new Blob(args);\n    } else {\n      throw Error(\"This browser doesn't seem to support creating Blobs\");\n    }\n  }\n}\n/**\r\n * Slices the blob. The returned blob contains data from the start byte\r\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n *\r\n * @param blob The blob to be sliced.\r\n * @param start Index of the starting byte.\r\n * @param end Index of the ending byte.\r\n * @return The blob slice or null if not supported.\r\n */\n\n\nfunction sliceBlob(blob, start, end) {\n  if (blob.webkitSlice) {\n    return blob.webkitSlice(start, end);\n  } else if (blob.mozSlice) {\n    return blob.mozSlice(start, end);\n  } else if (blob.slice) {\n    return blob.slice(start, end);\n  }\n\n  return null;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @param opt_elideCopy If true, doesn't copy mutable input data\r\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n *     modified after this blob's construction.\r\n */\n\n\nvar FbsBlob =\n/** @class */\nfunction () {\n  function FbsBlob(data, elideCopy) {\n    var size = 0;\n    var blobType = '';\n\n    if (isNativeBlob(data)) {\n      this.data_ = data;\n      size = data.size;\n      blobType = data.type;\n    } else if (data instanceof ArrayBuffer) {\n      if (elideCopy) {\n        this.data_ = new Uint8Array(data);\n      } else {\n        this.data_ = new Uint8Array(data.byteLength);\n        this.data_.set(new Uint8Array(data));\n      }\n\n      size = this.data_.length;\n    } else if (data instanceof Uint8Array) {\n      if (elideCopy) {\n        this.data_ = data;\n      } else {\n        this.data_ = new Uint8Array(data.length);\n        this.data_.set(data);\n      }\n\n      size = data.length;\n    }\n\n    this.size_ = size;\n    this.type_ = blobType;\n  }\n\n  FbsBlob.prototype.size = function () {\n    return this.size_;\n  };\n\n  FbsBlob.prototype.type = function () {\n    return this.type_;\n  };\n\n  FbsBlob.prototype.slice = function (startByte, endByte) {\n    if (isNativeBlob(this.data_)) {\n      var realBlob = this.data_;\n      var sliced = sliceBlob(realBlob, startByte, endByte);\n\n      if (sliced === null) {\n        return null;\n      }\n\n      return new FbsBlob(sliced);\n    } else {\n      var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\n      return new FbsBlob(slice, true);\n    }\n  };\n\n  FbsBlob.getBlob = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (isNativeBlobDefined()) {\n      var blobby = args.map(function (val) {\n        if (val instanceof FbsBlob) {\n          return val.data_;\n        } else {\n          return val;\n        }\n      });\n      return new FbsBlob(getBlob.apply(null, blobby));\n    } else {\n      var uint8Arrays = args.map(function (val) {\n        if (isString(val)) {\n          return dataFromString(StringFormat.RAW, val).data;\n        } else {\n          // Blobs don't exist, so this has to be a Uint8Array.\n          return val.data_;\n        }\n      });\n      var finalLength_1 = 0;\n      uint8Arrays.forEach(function (array) {\n        finalLength_1 += array.byteLength;\n      });\n      var merged_1 = new Uint8Array(finalLength_1);\n      var index_1 = 0;\n      uint8Arrays.forEach(function (array) {\n        for (var i = 0; i < array.length; i++) {\n          merged_1[index_1++] = array[i];\n        }\n      });\n      return new FbsBlob(merged_1, true);\n    }\n  };\n\n  FbsBlob.prototype.uploadData = function () {\n    return this.data_;\n  };\n\n  return FbsBlob;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @struct\r\n */\n\n\nvar Location =\n/** @class */\nfunction () {\n  function Location(bucket, path) {\n    this.bucket = bucket;\n    this.path_ = path;\n  }\n\n  Object.defineProperty(Location.prototype, \"path\", {\n    get: function () {\n      return this.path_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Location.prototype, \"isRoot\", {\n    get: function () {\n      return this.path.length === 0;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Location.prototype.fullServerUrl = function () {\n    var encode = encodeURIComponent;\n    return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\n  };\n\n  Location.prototype.bucketOnlyServerUrl = function () {\n    var encode = encodeURIComponent;\n    return '/b/' + encode(this.bucket) + '/o';\n  };\n\n  Location.makeFromBucketSpec = function (bucketString) {\n    var bucketLocation;\n\n    try {\n      bucketLocation = Location.makeFromUrl(bucketString);\n    } catch (e) {\n      // Not valid URL, use as-is. This lets you put bare bucket names in\n      // config.\n      return new Location(bucketString, '');\n    }\n\n    if (bucketLocation.path === '') {\n      return bucketLocation;\n    } else {\n      throw invalidDefaultBucket(bucketString);\n    }\n  };\n\n  Location.makeFromUrl = function (url) {\n    var location = null;\n    var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\n\n    function gsModify(loc) {\n      if (loc.path.charAt(loc.path.length - 1) === '/') {\n        loc.path_ = loc.path_.slice(0, -1);\n      }\n    }\n\n    var gsPath = '(/(.*))?$';\n    var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\n    var gsIndices = {\n      bucket: 1,\n      path: 3\n    };\n\n    function httpModify(loc) {\n      loc.path_ = decodeURIComponent(loc.path);\n    }\n\n    var version = 'v[A-Za-z0-9_]+';\n    var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\n    var firebaseStoragePath = '(/([^?#]*).*)?$';\n    var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\n    var firebaseStorageIndices = {\n      bucket: 1,\n      path: 3\n    };\n    var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\n    var cloudStoragePath = '([^?#]*)';\n    var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\n    var cloudStorageIndices = {\n      bucket: 1,\n      path: 2\n    };\n    var groups = [{\n      regex: gsRegex,\n      indices: gsIndices,\n      postModify: gsModify\n    }, {\n      regex: firebaseStorageRegExp,\n      indices: firebaseStorageIndices,\n      postModify: httpModify\n    }, {\n      regex: cloudStorageRegExp,\n      indices: cloudStorageIndices,\n      postModify: httpModify\n    }];\n\n    for (var i = 0; i < groups.length; i++) {\n      var group = groups[i];\n      var captures = group.regex.exec(url);\n\n      if (captures) {\n        var bucketValue = captures[group.indices.bucket];\n        var pathValue = captures[group.indices.path];\n\n        if (!pathValue) {\n          pathValue = '';\n        }\n\n        location = new Location(bucketValue, pathValue);\n        group.postModify(location);\n        break;\n      }\n    }\n\n    if (location == null) {\n      throw invalidUrl(url);\n    }\n\n    return location;\n  };\n\n  return Location;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns the Object resulting from parsing the given JSON, or null if the\r\n * given string does not represent a JSON object.\r\n */\n\n\nfunction jsonObjectOrNull(s) {\n  var obj;\n\n  try {\n    obj = JSON.parse(s);\n  } catch (e) {\n    return null;\n  }\n\n  if (isNonArrayObject(obj)) {\n    return obj;\n  } else {\n    return null;\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @fileoverview Contains helper methods for manipulating paths.\r\n */\n\n/**\r\n * @return Null if the path is already at the root.\r\n */\n\n\nfunction parent(path) {\n  if (path.length === 0) {\n    return null;\n  }\n\n  var index = path.lastIndexOf('/');\n\n  if (index === -1) {\n    return '';\n  }\n\n  var newPath = path.slice(0, index);\n  return newPath;\n}\n\nfunction child(path, childPath) {\n  var canonicalChildPath = childPath.split('/').filter(function (component) {\n    return component.length > 0;\n  }).join('/');\n\n  if (path.length === 0) {\n    return canonicalChildPath;\n  } else {\n    return path + '/' + canonicalChildPath;\n  }\n}\n/**\r\n * Returns the last component of a path.\r\n * '/foo/bar' -> 'bar'\r\n * '/foo/bar/baz/' -> 'baz/'\r\n * '/a' -> 'a'\r\n */\n\n\nfunction lastComponent(path) {\n  var index = path.lastIndexOf('/', path.length - 2);\n\n  if (index === -1) {\n    return path;\n  } else {\n    return path.slice(index + 1);\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction makeUrl(urlPart) {\n  return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\n}\n\nfunction makeQueryString(params) {\n  var encode = encodeURIComponent;\n  var queryPart = '?';\n\n  for (var key in params) {\n    if (params.hasOwnProperty(key)) {\n      // @ts-ignore TODO: remove once typescript is upgraded to 3.5.x\n      var nextPart = encode(key) + '=' + encode(params[key]);\n      queryPart = queryPart + nextPart + '&';\n    }\n  } // Chop off the extra '&' or '?' on the end\n\n\n  queryPart = queryPart.slice(0, -1);\n  return queryPart;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction noXform_(metadata, value) {\n  return value;\n}\n/**\r\n * @struct\r\n */\n\n\nvar Mapping =\n/** @class */\nfunction () {\n  function Mapping(server, local, writable, xform) {\n    this.server = server;\n    this.local = local || server;\n    this.writable = !!writable;\n    this.xform = xform || noXform_;\n  }\n\n  return Mapping;\n}();\n\nvar mappings_ = null;\n\nfunction xformPath(fullPath) {\n  if (!isString(fullPath) || fullPath.length < 2) {\n    return fullPath;\n  } else {\n    return lastComponent(fullPath);\n  }\n}\n\nfunction getMappings() {\n  if (mappings_) {\n    return mappings_;\n  }\n\n  var mappings = [];\n  mappings.push(new Mapping('bucket'));\n  mappings.push(new Mapping('generation'));\n  mappings.push(new Mapping('metageneration'));\n  mappings.push(new Mapping('name', 'fullPath', true));\n\n  function mappingsXformPath(_metadata, fullPath) {\n    return xformPath(fullPath);\n  }\n\n  var nameMapping = new Mapping('name');\n  nameMapping.xform = mappingsXformPath;\n  mappings.push(nameMapping);\n  /**\r\n   * Coerces the second param to a number, if it is defined.\r\n   */\n\n  function xformSize(_metadata, size) {\n    if (isDef(size)) {\n      return Number(size);\n    } else {\n      return size;\n    }\n  }\n\n  var sizeMapping = new Mapping('size');\n  sizeMapping.xform = xformSize;\n  mappings.push(sizeMapping);\n  mappings.push(new Mapping('timeCreated'));\n  mappings.push(new Mapping('updated'));\n  mappings.push(new Mapping('md5Hash', null, true));\n  mappings.push(new Mapping('cacheControl', null, true));\n  mappings.push(new Mapping('contentDisposition', null, true));\n  mappings.push(new Mapping('contentEncoding', null, true));\n  mappings.push(new Mapping('contentLanguage', null, true));\n  mappings.push(new Mapping('contentType', null, true));\n  mappings.push(new Mapping('metadata', 'customMetadata', true));\n  mappings_ = mappings;\n  return mappings_;\n}\n\nfunction addRef(metadata, service) {\n  function generateRef() {\n    var bucket = metadata['bucket'];\n    var path = metadata['fullPath'];\n    var loc = new Location(bucket, path);\n    return service.makeStorageReference(loc);\n  }\n\n  Object.defineProperty(metadata, 'ref', {\n    get: generateRef\n  });\n}\n\nfunction fromResource(service, resource, mappings) {\n  var metadata = {};\n  metadata['type'] = 'file';\n  var len = mappings.length;\n\n  for (var i = 0; i < len; i++) {\n    var mapping = mappings[i];\n    metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\n  }\n\n  addRef(metadata, service);\n  return metadata;\n}\n\nfunction fromResourceString(service, resourceString, mappings) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  var resource = obj;\n  return fromResource(service, resource, mappings);\n}\n\nfunction downloadUrlFromResourceString(metadata, resourceString) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  if (!isString(obj['downloadTokens'])) {\n    // This can happen if objects are uploaded through GCS and retrieved\n    // through list, so we don't want to throw an Error.\n    return null;\n  }\n\n  var tokens = obj['downloadTokens'];\n\n  if (tokens.length === 0) {\n    return null;\n  }\n\n  var encode = encodeURIComponent;\n  var tokensList = tokens.split(',');\n  var urls = tokensList.map(function (token) {\n    var bucket = metadata['bucket'];\n    var path = metadata['fullPath'];\n    var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\n    var base = makeUrl(urlPart);\n    var queryString = makeQueryString({\n      alt: 'media',\n      token: token\n    });\n    return base + queryString;\n  });\n  return urls[0];\n}\n\nfunction toResourceString(metadata, mappings) {\n  var resource = {};\n  var len = mappings.length;\n\n  for (var i = 0; i < len; i++) {\n    var mapping = mappings[i];\n\n    if (mapping.writable) {\n      resource[mapping.server] = metadata[mapping.local];\n    }\n  }\n\n  return JSON.stringify(resource);\n}\n\nfunction metadataValidator(p) {\n  if (!isObject(p) || !p) {\n    throw 'Expected Metadata object.';\n  }\n\n  for (var key in p) {\n    if (p.hasOwnProperty(key)) {\n      var val = p[key];\n\n      if (key === 'customMetadata') {\n        if (!isObject(val)) {\n          throw 'Expected object for \\'customMetadata\\' mapping.';\n        }\n      } else {\n        if (isNonNullObject(val)) {\n          throw \"Mapping for '\" + key + \"' cannot be an object.\";\n        }\n      }\n    }\n  }\n}\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MAX_RESULTS_KEY = 'maxResults';\nvar MAX_MAX_RESULTS = 1000;\nvar PAGE_TOKEN_KEY = 'pageToken';\nvar PREFIXES_KEY = 'prefixes';\nvar ITEMS_KEY = 'items';\n\nfunction fromBackendResponse(service, bucket, resource) {\n  var listResult = {\n    prefixes: [],\n    items: [],\n    nextPageToken: resource['nextPageToken']\n  };\n\n  if (resource[PREFIXES_KEY]) {\n    for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\n      var path = _a[_i];\n      var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\n      var reference = service.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\n      listResult.prefixes.push(reference);\n    }\n  }\n\n  if (resource[ITEMS_KEY]) {\n    for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\n      var item = _c[_b];\n      var reference = service.makeStorageReference(new Location(bucket, item['name']));\n      listResult.items.push(reference);\n    }\n  }\n\n  return listResult;\n}\n\nfunction fromResponseString(service, bucket, resourceString) {\n  var obj = jsonObjectOrNull(resourceString);\n\n  if (obj === null) {\n    return null;\n  }\n\n  var resource = obj;\n  return fromBackendResponse(service, bucket, resource);\n}\n\nfunction listOptionsValidator(p) {\n  if (!isObject(p) || !p) {\n    throw 'Expected ListOptions object.';\n  }\n\n  for (var key in p) {\n    if (key === MAX_RESULTS_KEY) {\n      if (!isInteger(p[MAX_RESULTS_KEY]) || p[MAX_RESULTS_KEY] <= 0) {\n        throw 'Expected maxResults to be a positive number.';\n      }\n\n      if (p[MAX_RESULTS_KEY] > 1000) {\n        throw \"Expected maxResults to be less than or equal to \" + MAX_MAX_RESULTS + \".\";\n      }\n    } else if (key === PAGE_TOKEN_KEY) {\n      if (p[PAGE_TOKEN_KEY] && !isString(p[PAGE_TOKEN_KEY])) {\n        throw 'Expected pageToken to be string.';\n      }\n    } else {\n      throw 'Unknown option: ' + key;\n    }\n  }\n}\n\nvar RequestInfo =\n/** @class */\nfunction () {\n  function RequestInfo(url, method,\n  /**\r\n   * Returns the value with which to resolve the request's promise. Only called\r\n   * if the request is successful. Throw from this function to reject the\r\n   * returned Request's promise with the thrown error.\r\n   * Note: The XhrIo passed to this function may be reused after this callback\r\n   * returns. Do not keep a reference to it in any way.\r\n   */\n  handler, timeout) {\n    this.url = url;\n    this.method = method;\n    this.handler = handler;\n    this.timeout = timeout;\n    this.urlParams = {};\n    this.headers = {};\n    this.body = null;\n    this.errorHandler = null;\n    /**\r\n     * Called with the current number of bytes uploaded and total size (-1 if not\r\n     * computable) of the request body (i.e. used to report upload progress).\r\n     */\n\n    this.progressCallback = null;\n    this.successCodes = [200];\n    this.additionalRetryCodes = [];\n  }\n\n  return RequestInfo;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n */\n\n\nfunction handlerCheck(cndn) {\n  if (!cndn) {\n    throw unknown();\n  }\n}\n\nfunction metadataHandler(service, mappings) {\n  function handler(xhr, text) {\n    var metadata = fromResourceString(service, text, mappings);\n    handlerCheck(metadata !== null);\n    return metadata;\n  }\n\n  return handler;\n}\n\nfunction listHandler(service, bucket) {\n  function handler(xhr, text) {\n    var listResult = fromResponseString(service, bucket, text);\n    handlerCheck(listResult !== null);\n    return listResult;\n  }\n\n  return handler;\n}\n\nfunction downloadUrlHandler(service, mappings) {\n  function handler(xhr, text) {\n    var metadata = fromResourceString(service, text, mappings);\n    handlerCheck(metadata !== null);\n    return downloadUrlFromResourceString(metadata, text);\n  }\n\n  return handler;\n}\n\nfunction sharedErrorHandler(location) {\n  function errorHandler(xhr, err) {\n    var newErr;\n\n    if (xhr.getStatus() === 401) {\n      newErr = unauthenticated();\n    } else {\n      if (xhr.getStatus() === 402) {\n        newErr = quotaExceeded(location.bucket);\n      } else {\n        if (xhr.getStatus() === 403) {\n          newErr = unauthorized(location.path);\n        } else {\n          newErr = err;\n        }\n      }\n    }\n\n    newErr.setServerResponseProp(err.serverResponseProp());\n    return newErr;\n  }\n\n  return errorHandler;\n}\n\nfunction objectErrorHandler(location) {\n  var shared = sharedErrorHandler(location);\n\n  function errorHandler(xhr, err) {\n    var newErr = shared(xhr, err);\n\n    if (xhr.getStatus() === 404) {\n      newErr = objectNotFound(location.path);\n    }\n\n    newErr.setServerResponseProp(err.serverResponseProp());\n    return newErr;\n  }\n\n  return errorHandler;\n}\n\nfunction getMetadata(service, location, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction list(service, location, delimiter, pageToken, maxResults) {\n  var urlParams = {};\n\n  if (location.isRoot) {\n    urlParams['prefix'] = '';\n  } else {\n    urlParams['prefix'] = location.path + '/';\n  }\n\n  if (delimiter && delimiter.length > 0) {\n    urlParams['delimiter'] = delimiter;\n  }\n\n  if (pageToken) {\n    urlParams['pageToken'] = pageToken;\n  }\n\n  if (maxResults) {\n    urlParams['maxResults'] = maxResults;\n  }\n\n  var urlPart = location.bucketOnlyServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, listHandler(service, location.bucket), timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n\nfunction getDownloadUrl(service, location, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'GET';\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, downloadUrlHandler(service, mappings), timeout);\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction updateMetadata(service, location, metadata, mappings) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'PATCH';\n  var body = toResourceString(metadata, mappings);\n  var headers = {\n    'Content-Type': 'application/json; charset=utf-8'\n  };\n  var timeout = service.maxOperationRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.headers = headers;\n  requestInfo.body = body;\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction deleteObject(service, location) {\n  var urlPart = location.fullServerUrl();\n  var url = makeUrl(urlPart);\n  var method = 'DELETE';\n  var timeout = service.maxOperationRetryTime;\n\n  function handler(_xhr, _text) {}\n\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.successCodes = [200, 204];\n  requestInfo.errorHandler = objectErrorHandler(location);\n  return requestInfo;\n}\n\nfunction determineContentType_(metadata, blob) {\n  return metadata && metadata['contentType'] || blob && blob.type() || 'application/octet-stream';\n}\n\nfunction metadataForUpload_(location, blob, metadata) {\n  var metadataClone = Object.assign({}, metadata);\n  metadataClone['fullPath'] = location.path;\n  metadataClone['size'] = blob.size();\n\n  if (!metadataClone['contentType']) {\n    metadataClone['contentType'] = determineContentType_(null, blob);\n  }\n\n  return metadataClone;\n}\n\nfunction multipartUpload(service, location, mappings, blob, metadata) {\n  var urlPart = location.bucketOnlyServerUrl();\n  var headers = {\n    'X-Goog-Upload-Protocol': 'multipart'\n  };\n\n  function genBoundary() {\n    var str = '';\n\n    for (var i = 0; i < 2; i++) {\n      str = str + Math.random().toString().slice(2);\n    }\n\n    return str;\n  }\n\n  var boundary = genBoundary();\n  headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\n  var metadata_ = metadataForUpload_(location, blob, metadata);\n  var metadataString = toResourceString(metadata_, mappings);\n  var preBlobPart = '--' + boundary + '\\r\\n' + 'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' + metadataString + '\\r\\n--' + boundary + '\\r\\n' + 'Content-Type: ' + metadata_['contentType'] + '\\r\\n\\r\\n';\n  var postBlobPart = '\\r\\n--' + boundary + '--';\n  var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\n\n  if (body === null) {\n    throw cannotSliceBlob();\n  }\n\n  var urlParams = {\n    name: metadata_['fullPath']\n  };\n  var url = makeUrl(urlPart);\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.headers = headers;\n  requestInfo.body = body.uploadData();\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\r\n * @param current The number of bytes that have been uploaded so far.\r\n * @param total The total number of bytes in the upload.\r\n * @param opt_finalized True if the server has finished the upload.\r\n * @param opt_metadata The upload metadata, should\r\n *     only be passed if opt_finalized is true.\r\n * @struct\r\n */\n\n\nvar ResumableUploadStatus =\n/** @class */\nfunction () {\n  function ResumableUploadStatus(current, total, finalized, metadata) {\n    this.current = current;\n    this.total = total;\n    this.finalized = !!finalized;\n    this.metadata = metadata || null;\n  }\n\n  return ResumableUploadStatus;\n}();\n\nfunction checkResumeHeader_(xhr, allowed) {\n  var status = null;\n\n  try {\n    status = xhr.getResponseHeader('X-Goog-Upload-Status');\n  } catch (e) {\n    handlerCheck(false);\n  }\n\n  var allowedStatus = allowed || ['active'];\n  handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\n  return status;\n}\n\nfunction createResumableUpload(service, location, mappings, blob, metadata) {\n  var urlPart = location.bucketOnlyServerUrl();\n  var metadataForUpload = metadataForUpload_(location, blob, metadata);\n  var urlParams = {\n    name: metadataForUpload['fullPath']\n  };\n  var url = makeUrl(urlPart);\n  var method = 'POST';\n  var headers = {\n    'X-Goog-Upload-Protocol': 'resumable',\n    'X-Goog-Upload-Command': 'start',\n    'X-Goog-Upload-Header-Content-Length': blob.size(),\n    'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\n    'Content-Type': 'application/json; charset=utf-8'\n  };\n  var body = toResourceString(metadataForUpload, mappings);\n  var timeout = service.maxUploadRetryTime;\n\n  function handler(xhr) {\n    checkResumeHeader_(xhr);\n    var url;\n\n    try {\n      url = xhr.getResponseHeader('X-Goog-Upload-URL');\n    } catch (e) {\n      handlerCheck(false);\n    }\n\n    handlerCheck(isString(url));\n    return url;\n  }\n\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.urlParams = urlParams;\n  requestInfo.headers = headers;\n  requestInfo.body = body;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n */\n\n\nfunction getResumableUploadStatus(service, location, url, blob) {\n  var headers = {\n    'X-Goog-Upload-Command': 'query'\n  };\n\n  function handler(xhr) {\n    var status = checkResumeHeader_(xhr, ['active', 'final']);\n    var sizeString = null;\n\n    try {\n      sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\n    } catch (e) {\n      handlerCheck(false);\n    }\n\n    if (!sizeString) {\n      // null or empty string\n      handlerCheck(false);\n    }\n\n    var size = Number(sizeString);\n    handlerCheck(!isNaN(size));\n    return new ResumableUploadStatus(size, blob.size(), status === 'final');\n  }\n\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.headers = headers;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\r\n * Any uploads via the resumable upload API must transfer a number of bytes\r\n * that is a multiple of this number.\r\n */\n\n\nvar resumableUploadChunkSize = 256 * 1024;\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n * @param chunkSize Number of bytes to upload.\r\n * @param status The previous status.\r\n *     If not passed or null, we start from the beginning.\r\n * @throws fbs.Error If the upload is already complete, the passed in status\r\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n *     for upload.\r\n */\n\nfunction continueResumableUpload(location, service, url, blob, chunkSize, mappings, status, progressCallback) {\n  // TODO(andysoto): standardize on internal asserts\n  // assert(!(opt_status && opt_status.finalized));\n  var status_ = new ResumableUploadStatus(0, 0);\n\n  if (status) {\n    status_.current = status.current;\n    status_.total = status.total;\n  } else {\n    status_.current = 0;\n    status_.total = blob.size();\n  }\n\n  if (blob.size() !== status_.total) {\n    throw serverFileWrongSize();\n  }\n\n  var bytesLeft = status_.total - status_.current;\n  var bytesToUpload = bytesLeft;\n\n  if (chunkSize > 0) {\n    bytesToUpload = Math.min(bytesToUpload, chunkSize);\n  }\n\n  var startByte = status_.current;\n  var endByte = startByte + bytesToUpload;\n  var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\n  var headers = {\n    'X-Goog-Upload-Command': uploadCommand,\n    'X-Goog-Upload-Offset': status_.current\n  };\n  var body = blob.slice(startByte, endByte);\n\n  if (body === null) {\n    throw cannotSliceBlob();\n  }\n\n  function handler(xhr, text) {\n    // TODO(andysoto): Verify the MD5 of each uploaded range:\n    // the 'x-range-md5' header comes back with status code 308 responses.\n    // We'll only be able to bail out though, because you can't re-upload a\n    // range that you previously uploaded.\n    var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\n    var newCurrent = status_.current + bytesToUpload;\n    var size = blob.size();\n    var metadata;\n\n    if (uploadStatus === 'final') {\n      metadata = metadataHandler(service, mappings)(xhr, text);\n    } else {\n      metadata = null;\n    }\n\n    return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\n  }\n\n  var method = 'POST';\n  var timeout = service.maxUploadRetryTime;\n  var requestInfo = new RequestInfo(url, method, handler, timeout);\n  requestInfo.headers = headers;\n  requestInfo.body = body.uploadData();\n  requestInfo.progressCallback = progressCallback || null;\n  requestInfo.errorHandler = sharedErrorHandler(location);\n  return requestInfo;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @struct\r\n */\n\n\nvar Observer =\n/** @class */\nfunction () {\n  function Observer(nextOrObserver, error, complete) {\n    var asFunctions = isFunction(nextOrObserver) || isDef(error) || isDef(complete);\n\n    if (asFunctions) {\n      this.next = nextOrObserver;\n      this.error = error || null;\n      this.complete = complete || null;\n    } else {\n      var observer = nextOrObserver;\n      this.next = observer.next || null;\n      this.error = observer.error || null;\n      this.complete = observer.complete || null;\n    }\n  }\n\n  return Observer;\n}();\n\nvar UploadTaskSnapshot =\n/** @class */\nfunction () {\n  function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\n    this.bytesTransferred = bytesTransferred;\n    this.totalBytes = totalBytes;\n    this.state = state;\n    this.metadata = metadata;\n    this.task = task;\n    this.ref = ref;\n  }\n\n  return UploadTaskSnapshot;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @param name Name of the function.\r\n * @param specs Argument specs.\r\n * @param passed The actual arguments passed to the function.\r\n * @throws {fbs.Error} If the arguments are invalid.\r\n */\n\n\nfunction validate(name, specs, passed) {\n  var minArgs = specs.length;\n  var maxArgs = specs.length;\n\n  for (var i = 0; i < specs.length; i++) {\n    if (specs[i].optional) {\n      minArgs = i;\n      break;\n    }\n  }\n\n  var validLength = minArgs <= passed.length && passed.length <= maxArgs;\n\n  if (!validLength) {\n    throw invalidArgumentCount(minArgs, maxArgs, name, passed.length);\n  }\n\n  for (var i = 0; i < passed.length; i++) {\n    try {\n      specs[i].validator(passed[i]);\n    } catch (e) {\n      if (e instanceof Error) {\n        throw invalidArgument(i, name, e.message);\n      } else {\n        throw invalidArgument(i, name, e);\n      }\n    }\n  }\n}\n/**\r\n * @struct\r\n */\n\n\nvar ArgSpec =\n/** @class */\nfunction () {\n  function ArgSpec(validator, optional) {\n    var self = this;\n\n    this.validator = function (p) {\n      if (self.optional && !isJustDef(p)) {\n        return;\n      }\n\n      validator(p);\n    };\n\n    this.optional = !!optional;\n  }\n\n  return ArgSpec;\n}();\n\nfunction and_(v1, v2) {\n  return function (p) {\n    v1(p);\n    v2(p);\n  };\n}\n\nfunction stringSpec(validator, optional) {\n  function stringValidator(p) {\n    if (!isString(p)) {\n      throw 'Expected string.';\n    }\n  }\n\n  var chainedValidator;\n\n  if (validator) {\n    chainedValidator = and_(stringValidator, validator);\n  } else {\n    chainedValidator = stringValidator;\n  }\n\n  return new ArgSpec(chainedValidator, optional);\n}\n\nfunction uploadDataSpec() {\n  function validator(p) {\n    var valid = p instanceof Uint8Array || p instanceof ArrayBuffer || isNativeBlobDefined() && p instanceof Blob;\n\n    if (!valid) {\n      throw 'Expected Blob or File.';\n    }\n  }\n\n  return new ArgSpec(validator);\n}\n\nfunction metadataSpec(optional) {\n  return new ArgSpec(metadataValidator, optional);\n}\n\nfunction listOptionSpec(optional) {\n  return new ArgSpec(listOptionsValidator, optional);\n}\n\nfunction nonNegativeNumberSpec() {\n  function validator(p) {\n    var valid = isNumber(p) && p >= 0;\n\n    if (!valid) {\n      throw 'Expected a number 0 or greater.';\n    }\n  }\n\n  return new ArgSpec(validator);\n}\n\nfunction looseObjectSpec(validator, optional) {\n  function isLooseObjectValidator(p) {\n    var isLooseObject = p === null || isDef(p) && p instanceof Object;\n\n    if (!isLooseObject) {\n      throw 'Expected an Object.';\n    }\n\n    if (validator !== undefined && validator !== null) {\n      validator(p);\n    }\n  }\n\n  return new ArgSpec(isLooseObjectValidator, optional);\n}\n\nfunction nullFunctionSpec(optional) {\n  function validator(p) {\n    var valid = p === null || isFunction(p);\n\n    if (!valid) {\n      throw 'Expected a Function.';\n    }\n  }\n\n  return new ArgSpec(validator, optional);\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a function that invokes f with its arguments asynchronously as a\r\n * microtask, i.e. as soon as possible after the current script returns back\r\n * into browser code.\r\n */\n// eslint-disable-next-line @typescript-eslint/ban-types\n\n\nfunction async(f) {\n  return function () {\n    var argsToForward = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      argsToForward[_i] = arguments[_i];\n    } // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n    Promise.resolve().then(function () {\n      return f.apply(void 0, argsToForward);\n    });\n  };\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n * upload and manage callbacks for various events.\r\n */\n\n\nvar UploadTask =\n/** @class */\nfunction () {\n  /**\r\n   * @param ref The firebaseStorage.Reference object this task came\r\n   *     from, untyped to avoid cyclic dependencies.\r\n   * @param blob The blob to upload.\r\n   */\n  function UploadTask(ref, service, location, mappings, blob, metadata) {\n    var _this = this;\n\n    if (metadata === void 0) {\n      metadata = null;\n    }\n\n    this.transferred_ = 0;\n    this.needToFetchStatus_ = false;\n    this.needToFetchMetadata_ = false;\n    this.observers_ = [];\n    this.error_ = null;\n    this.uploadUrl_ = null;\n    this.request_ = null;\n    this.chunkMultiplier_ = 1;\n    this.resolve_ = null;\n    this.reject_ = null;\n    this.ref_ = ref;\n    this.service_ = service;\n    this.location_ = location;\n    this.blob_ = blob;\n    this.metadata_ = metadata;\n    this.mappings_ = mappings;\n    this.resumable_ = this.shouldDoResumable_(this.blob_);\n    this.state_ = InternalTaskState.RUNNING;\n\n    this.errorHandler_ = function (error) {\n      _this.request_ = null;\n      _this.chunkMultiplier_ = 1;\n\n      if (error.codeEquals(Code.CANCELED)) {\n        _this.needToFetchStatus_ = true;\n\n        _this.completeTransitions_();\n      } else {\n        _this.error_ = error;\n\n        _this.transition_(InternalTaskState.ERROR);\n      }\n    };\n\n    this.metadataErrorHandler_ = function (error) {\n      _this.request_ = null;\n\n      if (error.codeEquals(Code.CANCELED)) {\n        _this.completeTransitions_();\n      } else {\n        _this.error_ = error;\n\n        _this.transition_(InternalTaskState.ERROR);\n      }\n    };\n\n    this.promise_ = new Promise(function (resolve, reject) {\n      _this.resolve_ = resolve;\n      _this.reject_ = reject;\n\n      _this.start_();\n    }); // Prevent uncaught rejections on the internal promise from bubbling out\n    // to the top level with a dummy handler.\n\n    this.promise_.then(null, function () {});\n  }\n\n  UploadTask.prototype.makeProgressCallback_ = function () {\n    var _this = this;\n\n    var sizeBefore = this.transferred_;\n    return function (loaded) {\n      return _this.updateProgress_(sizeBefore + loaded);\n    };\n  };\n\n  UploadTask.prototype.shouldDoResumable_ = function (blob) {\n    return blob.size() > 256 * 1024;\n  };\n\n  UploadTask.prototype.start_ = function () {\n    if (this.state_ !== InternalTaskState.RUNNING) {\n      // This can happen if someone pauses us in a resume callback, for example.\n      return;\n    }\n\n    if (this.request_ !== null) {\n      return;\n    }\n\n    if (this.resumable_) {\n      if (this.uploadUrl_ === null) {\n        this.createResumable_();\n      } else {\n        if (this.needToFetchStatus_) {\n          this.fetchStatus_();\n        } else {\n          if (this.needToFetchMetadata_) {\n            // Happens if we miss the metadata on upload completion.\n            this.fetchMetadata_();\n          } else {\n            this.continueUpload_();\n          }\n        }\n      }\n    } else {\n      this.oneShotUpload_();\n    }\n  };\n\n  UploadTask.prototype.resolveToken_ = function (callback) {\n    var _this = this; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n    this.service_.getAuthToken().then(function (authToken) {\n      switch (_this.state_) {\n        case InternalTaskState.RUNNING:\n          callback(authToken);\n          break;\n\n        case InternalTaskState.CANCELING:\n          _this.transition_(InternalTaskState.CANCELED);\n\n          break;\n\n        case InternalTaskState.PAUSING:\n          _this.transition_(InternalTaskState.PAUSED);\n\n          break;\n      }\n    });\n  }; // TODO(andysoto): assert false\n\n\n  UploadTask.prototype.createResumable_ = function () {\n    var _this = this;\n\n    this.resolveToken_(function (authToken) {\n      var requestInfo = createResumableUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\n\n      var createRequest = _this.service_.makeRequest(requestInfo, authToken);\n\n      _this.request_ = createRequest;\n      createRequest.getPromise().then(function (url) {\n        _this.request_ = null;\n        _this.uploadUrl_ = url;\n        _this.needToFetchStatus_ = false;\n\n        _this.completeTransitions_();\n      }, _this.errorHandler_);\n    });\n  };\n\n  UploadTask.prototype.fetchStatus_ = function () {\n    var _this = this; // TODO(andysoto): assert(this.uploadUrl_ !== null);\n\n\n    var url = this.uploadUrl_;\n    this.resolveToken_(function (authToken) {\n      var requestInfo = getResumableUploadStatus(_this.service_, _this.location_, url, _this.blob_);\n\n      var statusRequest = _this.service_.makeRequest(requestInfo, authToken);\n\n      _this.request_ = statusRequest;\n      statusRequest.getPromise().then(function (status) {\n        status = status;\n        _this.request_ = null;\n\n        _this.updateProgress_(status.current);\n\n        _this.needToFetchStatus_ = false;\n\n        if (status.finalized) {\n          _this.needToFetchMetadata_ = true;\n        }\n\n        _this.completeTransitions_();\n      }, _this.errorHandler_);\n    });\n  };\n\n  UploadTask.prototype.continueUpload_ = function () {\n    var _this = this;\n\n    var chunkSize = resumableUploadChunkSize * this.chunkMultiplier_;\n    var status = new ResumableUploadStatus(this.transferred_, this.blob_.size()); // TODO(andysoto): assert(this.uploadUrl_ !== null);\n\n    var url = this.uploadUrl_;\n    this.resolveToken_(function (authToken) {\n      var requestInfo;\n\n      try {\n        requestInfo = continueResumableUpload(_this.location_, _this.service_, url, _this.blob_, chunkSize, _this.mappings_, status, _this.makeProgressCallback_());\n      } catch (e) {\n        _this.error_ = e;\n\n        _this.transition_(InternalTaskState.ERROR);\n\n        return;\n      }\n\n      var uploadRequest = _this.service_.makeRequest(requestInfo, authToken);\n\n      _this.request_ = uploadRequest;\n      uploadRequest.getPromise().then(function (newStatus) {\n        _this.increaseMultiplier_();\n\n        _this.request_ = null;\n\n        _this.updateProgress_(newStatus.current);\n\n        if (newStatus.finalized) {\n          _this.metadata_ = newStatus.metadata;\n\n          _this.transition_(InternalTaskState.SUCCESS);\n        } else {\n          _this.completeTransitions_();\n        }\n      }, _this.errorHandler_);\n    });\n  };\n\n  UploadTask.prototype.increaseMultiplier_ = function () {\n    var currentSize = resumableUploadChunkSize * this.chunkMultiplier_; // Max chunk size is 32M.\n\n    if (currentSize < 32 * 1024 * 1024) {\n      this.chunkMultiplier_ *= 2;\n    }\n  };\n\n  UploadTask.prototype.fetchMetadata_ = function () {\n    var _this = this;\n\n    this.resolveToken_(function (authToken) {\n      var requestInfo = getMetadata(_this.service_, _this.location_, _this.mappings_);\n\n      var metadataRequest = _this.service_.makeRequest(requestInfo, authToken);\n\n      _this.request_ = metadataRequest;\n      metadataRequest.getPromise().then(function (metadata) {\n        _this.request_ = null;\n        _this.metadata_ = metadata;\n\n        _this.transition_(InternalTaskState.SUCCESS);\n      }, _this.metadataErrorHandler_);\n    });\n  };\n\n  UploadTask.prototype.oneShotUpload_ = function () {\n    var _this = this;\n\n    this.resolveToken_(function (authToken) {\n      var requestInfo = multipartUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\n\n      var multipartRequest = _this.service_.makeRequest(requestInfo, authToken);\n\n      _this.request_ = multipartRequest;\n      multipartRequest.getPromise().then(function (metadata) {\n        _this.request_ = null;\n        _this.metadata_ = metadata;\n\n        _this.updateProgress_(_this.blob_.size());\n\n        _this.transition_(InternalTaskState.SUCCESS);\n      }, _this.errorHandler_);\n    });\n  };\n\n  UploadTask.prototype.updateProgress_ = function (transferred) {\n    var old = this.transferred_;\n    this.transferred_ = transferred; // A progress update can make the \"transferred\" value smaller (e.g. a\n    // partial upload not completed by server, after which the \"transferred\"\n    // value may reset to the value at the beginning of the request).\n\n    if (this.transferred_ !== old) {\n      this.notifyObservers_();\n    }\n  };\n\n  UploadTask.prototype.transition_ = function (state) {\n    if (this.state_ === state) {\n      return;\n    }\n\n    switch (state) {\n      case InternalTaskState.CANCELING:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING);\n        this.state_ = state;\n\n        if (this.request_ !== null) {\n          this.request_.cancel();\n        }\n\n        break;\n\n      case InternalTaskState.PAUSING:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING);\n        this.state_ = state;\n\n        if (this.request_ !== null) {\n          this.request_.cancel();\n        }\n\n        break;\n\n      case InternalTaskState.RUNNING:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSED ||\n        //        this.state_ === InternalTaskState.PAUSING);\n        var wasPaused = this.state_ === InternalTaskState.PAUSED;\n        this.state_ = state;\n\n        if (wasPaused) {\n          this.notifyObservers_();\n          this.start_();\n        }\n\n        break;\n\n      case InternalTaskState.PAUSED:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSING);\n        this.state_ = state;\n        this.notifyObservers_();\n        break;\n\n      case InternalTaskState.CANCELED:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.PAUSED ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this.error_ = canceled();\n        this.state_ = state;\n        this.notifyObservers_();\n        break;\n\n      case InternalTaskState.ERROR:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this.state_ = state;\n        this.notifyObservers_();\n        break;\n\n      case InternalTaskState.SUCCESS:\n        // TODO(andysoto):\n        // assert(this.state_ === InternalTaskState.RUNNING ||\n        //        this.state_ === InternalTaskState.PAUSING ||\n        //        this.state_ === InternalTaskState.CANCELING);\n        this.state_ = state;\n        this.notifyObservers_();\n        break;\n    }\n  };\n\n  UploadTask.prototype.completeTransitions_ = function () {\n    switch (this.state_) {\n      case InternalTaskState.PAUSING:\n        this.transition_(InternalTaskState.PAUSED);\n        break;\n\n      case InternalTaskState.CANCELING:\n        this.transition_(InternalTaskState.CANCELED);\n        break;\n\n      case InternalTaskState.RUNNING:\n        this.start_();\n        break;\n    }\n  };\n\n  Object.defineProperty(UploadTask.prototype, \"snapshot\", {\n    get: function () {\n      var externalState = taskStateFromInternalTaskState(this.state_);\n      return new UploadTaskSnapshot(this.transferred_, this.blob_.size(), externalState, this.metadata_, this, this.ref_);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Adds a callback for an event.\r\n   * @param type The type of event to listen for.\r\n   */\n\n  UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\n    function typeValidator() {\n      if (type !== TaskEvent.STATE_CHANGED) {\n        throw \"Expected one of the event types: [\" + TaskEvent.STATE_CHANGED + \"].\";\n      }\n    }\n\n    var nextOrObserverMessage = 'Expected a function or an Object with one of ' + '`next`, `error`, `complete` properties.';\n    var nextValidator = nullFunctionSpec(true).validator;\n    var observerValidator = looseObjectSpec(null, true).validator; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    function nextOrObserverValidator(p) {\n      try {\n        nextValidator(p);\n        return;\n      } catch (e) {}\n\n      try {\n        observerValidator(p);\n        var anyDefined = isJustDef(p['next']) || isJustDef(p['error']) || isJustDef(p['complete']);\n\n        if (!anyDefined) {\n          throw '';\n        }\n\n        return;\n      } catch (e) {\n        throw nextOrObserverMessage;\n      }\n    }\n\n    var specs = [stringSpec(typeValidator), looseObjectSpec(nextOrObserverValidator, true), nullFunctionSpec(true), nullFunctionSpec(true)];\n    validate('on', specs, arguments);\n    var self = this;\n\n    function makeBinder(specs) {\n      function binder(nextOrObserver, error, complete) {\n        if (specs !== null) {\n          validate('on', specs, arguments);\n        }\n\n        var observer = new Observer(nextOrObserver, error, completed);\n        self.addObserver_(observer);\n        return function () {\n          self.removeObserver_(observer);\n        };\n      }\n\n      return binder;\n    }\n\n    function binderNextOrObserverValidator(p) {\n      if (p === null) {\n        throw nextOrObserverMessage;\n      }\n\n      nextOrObserverValidator(p);\n    }\n\n    var binderSpecs = [looseObjectSpec(binderNextOrObserverValidator), nullFunctionSpec(true), nullFunctionSpec(true)];\n    var typeOnly = !(isJustDef(nextOrObserver) || isJustDef(error) || isJustDef(completed));\n\n    if (typeOnly) {\n      return makeBinder(binderSpecs);\n    } else {\n      return makeBinder(null)(nextOrObserver, error, completed);\n    }\n  };\n  /**\r\n   * This object behaves like a Promise, and resolves with its snapshot data\r\n   * when the upload completes.\r\n   * @param onFulfilled The fulfillment callback. Promise chaining works as normal.\r\n   * @param onRejected The rejection callback.\r\n   */\n\n\n  UploadTask.prototype.then = function (onFulfilled, onRejected) {\n    // These casts are needed so that TypeScript can infer the types of the\n    // resulting Promise.\n    return this.promise_.then(onFulfilled, onRejected);\n  };\n  /**\r\n   * Equivalent to calling `then(null, onRejected)`.\r\n   */\n\n\n  UploadTask.prototype.catch = function (onRejected) {\n    return this.then(null, onRejected);\n  };\n  /**\r\n   * Adds the given observer.\r\n   */\n\n\n  UploadTask.prototype.addObserver_ = function (observer) {\n    this.observers_.push(observer);\n    this.notifyObserver_(observer);\n  };\n  /**\r\n   * Removes the given observer.\r\n   */\n\n\n  UploadTask.prototype.removeObserver_ = function (observer) {\n    var i = this.observers_.indexOf(observer);\n\n    if (i !== -1) {\n      this.observers_.splice(i, 1);\n    }\n  };\n\n  UploadTask.prototype.notifyObservers_ = function () {\n    var _this = this;\n\n    this.finishPromise_();\n    var observers = this.observers_.slice();\n    observers.forEach(function (observer) {\n      _this.notifyObserver_(observer);\n    });\n  };\n\n  UploadTask.prototype.finishPromise_ = function () {\n    if (this.resolve_ !== null) {\n      var triggered = true;\n\n      switch (taskStateFromInternalTaskState(this.state_)) {\n        case TaskState.SUCCESS:\n          async(this.resolve_.bind(null, this.snapshot))();\n          break;\n\n        case TaskState.CANCELED:\n        case TaskState.ERROR:\n          var toCall = this.reject_;\n          async(toCall.bind(null, this.error_))();\n          break;\n\n        default:\n          triggered = false;\n          break;\n      }\n\n      if (triggered) {\n        this.resolve_ = null;\n        this.reject_ = null;\n      }\n    }\n  };\n\n  UploadTask.prototype.notifyObserver_ = function (observer) {\n    var externalState = taskStateFromInternalTaskState(this.state_);\n\n    switch (externalState) {\n      case TaskState.RUNNING:\n      case TaskState.PAUSED:\n        if (observer.next) {\n          async(observer.next.bind(observer, this.snapshot))();\n        }\n\n        break;\n\n      case TaskState.SUCCESS:\n        if (observer.complete) {\n          async(observer.complete.bind(observer))();\n        }\n\n        break;\n\n      case TaskState.CANCELED:\n      case TaskState.ERROR:\n        if (observer.error) {\n          async(observer.error.bind(observer, this.error_))();\n        }\n\n        break;\n\n      default:\n        // TODO(andysoto): assert(false);\n        if (observer.error) {\n          async(observer.error.bind(observer, this.error_))();\n        }\n\n    }\n  };\n  /**\r\n   * Resumes a paused task. Has no effect on a currently running or failed task.\r\n   * @return True if the operation took effect, false if ignored.\r\n   */\n\n\n  UploadTask.prototype.resume = function () {\n    validate('resume', [], arguments);\n    var valid = this.state_ === InternalTaskState.PAUSED || this.state_ === InternalTaskState.PAUSING;\n\n    if (valid) {\n      this.transition_(InternalTaskState.RUNNING);\n    }\n\n    return valid;\n  };\n  /**\r\n   * Pauses a currently running task. Has no effect on a paused or failed task.\r\n   * @return True if the operation took effect, false if ignored.\r\n   */\n\n\n  UploadTask.prototype.pause = function () {\n    validate('pause', [], arguments);\n    var valid = this.state_ === InternalTaskState.RUNNING;\n\n    if (valid) {\n      this.transition_(InternalTaskState.PAUSING);\n    }\n\n    return valid;\n  };\n  /**\r\n   * Cancels a currently running or paused task. Has no effect on a complete or\r\n   * failed task.\r\n   * @return True if the operation took effect, false if ignored.\r\n   */\n\n\n  UploadTask.prototype.cancel = function () {\n    validate('cancel', [], arguments);\n    var valid = this.state_ === InternalTaskState.RUNNING || this.state_ === InternalTaskState.PAUSING;\n\n    if (valid) {\n      this.transition_(InternalTaskState.CANCELING);\n    }\n\n    return valid;\n  };\n\n  return UploadTask;\n}();\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Provides methods to interact with a bucket in the Firebase Storage service.\r\n * @param location An fbs.location, or the URL at\r\n *     which to base this object, in one of the following forms:\r\n *         gs://<bucket>/<object-path>\r\n *         http[s]://firebasestorage.googleapis.com/\r\n *                     <api-version>/b/<bucket>/o/<object-path>\r\n *     Any query or fragment strings will be ignored in the http[s]\r\n *     format. If no value is passed, the storage object will use a URL based on\r\n *     the project ID of the base firebase.App instance.\r\n */\n\n\nvar Reference =\n/** @class */\nfunction () {\n  function Reference(service, location) {\n    this.service = service;\n\n    if (location instanceof Location) {\n      this.location = location;\n    } else {\n      this.location = Location.makeFromUrl(location);\n    }\n  }\n  /**\r\n   * @return The URL for the bucket and path this object references,\r\n   *     in the form gs://<bucket>/<object-path>\r\n   * @override\r\n   */\n\n\n  Reference.prototype.toString = function () {\n    validate('toString', [], arguments);\n    return 'gs://' + this.location.bucket + '/' + this.location.path;\n  };\n\n  Reference.prototype.newRef = function (service, location) {\n    return new Reference(service, location);\n  };\n\n  Reference.prototype.mappings = function () {\n    return getMappings();\n  };\n  /**\r\n   * @return A reference to the object obtained by\r\n   *     appending childPath, removing any duplicate, beginning, or trailing\r\n   *     slashes.\r\n   */\n\n\n  Reference.prototype.child = function (childPath) {\n    validate('child', [stringSpec()], arguments);\n    var newPath = child(this.location.path, childPath);\n    var location = new Location(this.location.bucket, newPath);\n    return this.newRef(this.service, location);\n  };\n\n  Object.defineProperty(Reference.prototype, \"parent\", {\n    /**\r\n     * @return A reference to the parent of the\r\n     *     current object, or null if the current object is the root.\r\n     */\n    get: function () {\n      var newPath = parent(this.location.path);\n\n      if (newPath === null) {\n        return null;\n      }\n\n      var location = new Location(this.location.bucket, newPath);\n      return this.newRef(this.service, location);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"root\", {\n    /**\r\n     * @return An reference to the root of this\r\n     *     object's bucket.\r\n     */\n    get: function () {\n      var location = new Location(this.location.bucket, '');\n      return this.newRef(this.service, location);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"bucket\", {\n    get: function () {\n      return this.location.bucket;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"fullPath\", {\n    get: function () {\n      return this.location.path;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"name\", {\n    get: function () {\n      return lastComponent(this.location.path);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Reference.prototype, \"storage\", {\n    get: function () {\n      return this.service;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\r\n   * Uploads a blob to this object's location.\r\n   * @param data The blob to upload.\r\n   * @return An UploadTask that lets you control and\r\n   *     observe the upload.\r\n   */\n\n  Reference.prototype.put = function (data, metadata) {\n    if (metadata === void 0) {\n      metadata = null;\n    }\n\n    validate('put', [uploadDataSpec(), metadataSpec(true)], arguments);\n    this.throwIfRoot_('put');\n    return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data), metadata);\n  };\n  /**\r\n   * Uploads a string to this object's location.\r\n   * @param value The string to upload.\r\n   * @param format The format of the string to upload.\r\n   * @return An UploadTask that lets you control and\r\n   *     observe the upload.\r\n   */\n\n\n  Reference.prototype.putString = function (value, format, metadata) {\n    if (format === void 0) {\n      format = StringFormat.RAW;\n    }\n\n    validate('putString', [stringSpec(), stringSpec(formatValidator, true), metadataSpec(true)], arguments);\n    this.throwIfRoot_('putString');\n    var data = dataFromString(format, value);\n    var metadataClone = Object.assign({}, metadata);\n\n    if (!isDef(metadataClone['contentType']) && isDef(data.contentType)) {\n      metadataClone['contentType'] = data.contentType;\n    }\n\n    return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data.data, true), metadataClone);\n  };\n  /**\r\n   * Deletes the object at this location.\r\n   * @return A promise that resolves if the deletion succeeds.\r\n   */\n\n\n  Reference.prototype.delete = function () {\n    var _this = this;\n\n    validate('delete', [], arguments);\n    this.throwIfRoot_('delete');\n    return this.service.getAuthToken().then(function (authToken) {\n      var requestInfo = deleteObject(_this.service, _this.location);\n      return _this.service.makeRequest(requestInfo, authToken).getPromise();\n    });\n  };\n  /**\r\n   * List all items (files) and prefixes (folders) under this storage reference.\r\n   *\r\n   * This is a helper method for calling list() repeatedly until there are\r\n   * no more results. The default pagination size is 1000.\r\n   *\r\n   * Note: The results may not be consistent if objects are changed while this\r\n   * operation is running.\r\n   *\r\n   * Warning: listAll may potentially consume too many resources if there are\r\n   * too many results.\r\n   *\r\n   * @return A Promise that resolves with all the items and prefixes under\r\n   *      the current storage reference. `prefixes` contains references to\r\n   *      sub-directories and `items` contains references to objects in this\r\n   *      folder. `nextPageToken` is never returned.\r\n   */\n\n\n  Reference.prototype.listAll = function () {\n    validate('listAll', [], arguments);\n    var accumulator = {\n      prefixes: [],\n      items: []\n    };\n    return this.listAllHelper(accumulator).then(function () {\n      return accumulator;\n    });\n  };\n\n  Reference.prototype.listAllHelper = function (accumulator, pageToken) {\n    return __awaiter(this, void 0, void 0, function () {\n      var opt, nextPage;\n\n      var _a, _b;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            opt = {\n              // maxResults is 1000 by default.\n              pageToken: pageToken\n            };\n            return [4\n            /*yield*/\n            , this.list(opt)];\n\n          case 1:\n            nextPage = _c.sent();\n\n            (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\n\n            (_b = accumulator.items).push.apply(_b, nextPage.items);\n\n            if (!(nextPage.nextPageToken != null)) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , this.listAllHelper(accumulator, nextPage.nextPageToken)];\n\n          case 2:\n            _c.sent();\n\n            _c.label = 3;\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * List items (files) and prefixes (folders) under this storage reference.\r\n   *\r\n   * List API is only available for Firebase Rules Version 2.\r\n   *\r\n   * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n   * delimited folder structure.\r\n   * Refer to GCS's List API if you want to learn more.\r\n   *\r\n   * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n   * support objects whose paths end with \"/\" or contain two consecutive\r\n   * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n   * list() may fail if there are too many unsupported objects in the bucket.\r\n   *\r\n   * @param options See ListOptions for details.\r\n   * @return A Promise that resolves with the items and prefixes.\r\n   *      `prefixes` contains references to sub-folders and `items`\r\n   *      contains references to objects in this folder. `nextPageToken`\r\n   *      can be used to get the rest of the results.\r\n   */\n\n\n  Reference.prototype.list = function (options) {\n    validate('list', [listOptionSpec(true)], arguments);\n    var self = this;\n    return this.service.getAuthToken().then(function (authToken) {\n      var op = options || {};\n      var requestInfo = list(self.service, self.location,\n      /*delimiter= */\n      '/', op.pageToken, op.maxResults);\n      return self.service.makeRequest(requestInfo, authToken).getPromise();\n    });\n  };\n  /**\r\n   *     A promise that resolves with the metadata for this object. If this\r\n   *     object doesn't exist or metadata cannot be retreived, the promise is\r\n   *     rejected.\r\n   */\n\n\n  Reference.prototype.getMetadata = function () {\n    var _this = this;\n\n    validate('getMetadata', [], arguments);\n    this.throwIfRoot_('getMetadata');\n    return this.service.getAuthToken().then(function (authToken) {\n      var requestInfo = getMetadata(_this.service, _this.location, _this.mappings());\n      return _this.service.makeRequest(requestInfo, authToken).getPromise();\n    });\n  };\n  /**\r\n   * Updates the metadata for this object.\r\n   * @param metadata The new metadata for the object.\r\n   *     Only values that have been explicitly set will be changed. Explicitly\r\n   *     setting a value to null will remove the metadata.\r\n   * @return A promise that resolves\r\n   *     with the new metadata for this object.\r\n   *     @see firebaseStorage.Reference.prototype.getMetadata\r\n   */\n\n\n  Reference.prototype.updateMetadata = function (metadata) {\n    var _this = this;\n\n    validate('updateMetadata', [metadataSpec()], arguments);\n    this.throwIfRoot_('updateMetadata');\n    return this.service.getAuthToken().then(function (authToken) {\n      var requestInfo = updateMetadata(_this.service, _this.location, metadata, _this.mappings());\n      return _this.service.makeRequest(requestInfo, authToken).getPromise();\n    });\n  };\n  /**\r\n   * @return A promise that resolves with the download\r\n   *     URL for this object.\r\n   */\n\n\n  Reference.prototype.getDownloadURL = function () {\n    var _this = this;\n\n    validate('getDownloadURL', [], arguments);\n    this.throwIfRoot_('getDownloadURL');\n    return this.service.getAuthToken().then(function (authToken) {\n      var requestInfo = getDownloadUrl(_this.service, _this.location, _this.mappings());\n      return _this.service.makeRequest(requestInfo, authToken).getPromise().then(function (url) {\n        if (url === null) {\n          throw noDownloadURL();\n        }\n\n        return url;\n      });\n    });\n  };\n\n  Reference.prototype.throwIfRoot_ = function (name) {\n    if (this.location.path === '') {\n      throw invalidRootOperation(name);\n    }\n  };\n\n  return Reference;\n}();\n/**\r\n * A request whose promise always fails.\r\n * @struct\r\n * @template T\r\n */\n\n\nvar FailRequest =\n/** @class */\nfunction () {\n  function FailRequest(error) {\n    this.promise_ = Promise.reject(error);\n  }\n  /** @inheritDoc */\n\n\n  FailRequest.prototype.getPromise = function () {\n    return this.promise_;\n  };\n  /** @inheritDoc */\n\n\n  FailRequest.prototype.cancel = function (_appDelete) {};\n\n  return FailRequest;\n}();\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @param f May be invoked\r\n *     before the function returns.\r\n * @param callback Get all the arguments passed to the function\r\n *     passed to f, including the initial boolean.\r\n */\n\n\nfunction start(f, // eslint-disable-next-line @typescript-eslint/no-explicit-any\ncallback, timeout) {\n  // TODO(andysoto): make this code cleaner (probably refactor into an actual\n  // type instead of a bunch of functions with state shared in the closure)\n  var waitSeconds = 1; // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\n  // TODO: find a way to exclude Node type definition for storage because storage only works in browser\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  var timeoutId = null;\n  var hitTimeout = false;\n  var cancelState = 0;\n\n  function canceled() {\n    return cancelState === 2;\n  }\n\n  var triggeredCallback = false; // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\n  // the no-explicit-any rule when ESlint releases it.\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n  function triggerCallback() {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (!triggeredCallback) {\n      triggeredCallback = true;\n      callback.apply(null, args);\n    }\n  }\n\n  function callWithDelay(millis) {\n    timeoutId = setTimeout(function () {\n      timeoutId = null;\n      f(handler, canceled());\n    }, millis);\n  } // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\n  // the no-explicit-any rule when ESlint releases it.\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  function handler(success) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    if (triggeredCallback) {\n      return;\n    }\n\n    if (success) {\n      triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\n      return;\n    }\n\n    var mustStop = canceled() || hitTimeout;\n\n    if (mustStop) {\n      triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\n      return;\n    }\n\n    if (waitSeconds < 64) {\n      /* TODO(andysoto): don't back off so quickly if we know we're offline. */\n      waitSeconds *= 2;\n    }\n\n    var waitMillis;\n\n    if (cancelState === 1) {\n      cancelState = 2;\n      waitMillis = 0;\n    } else {\n      waitMillis = (waitSeconds + Math.random()) * 1000;\n    }\n\n    callWithDelay(waitMillis);\n  }\n\n  var stopped = false;\n\n  function stop(wasTimeout) {\n    if (stopped) {\n      return;\n    }\n\n    stopped = true;\n\n    if (triggeredCallback) {\n      return;\n    }\n\n    if (timeoutId !== null) {\n      if (!wasTimeout) {\n        cancelState = 2;\n      }\n\n      clearTimeout(timeoutId);\n      callWithDelay(0);\n    } else {\n      if (!wasTimeout) {\n        cancelState = 1;\n      }\n    }\n  }\n\n  callWithDelay(0);\n  setTimeout(function () {\n    hitTimeout = true;\n    stop(true);\n  }, timeout);\n  return stop;\n}\n/**\r\n * Stops the retry loop from repeating.\r\n * If the function is currently \"in between\" retries, it is invoked immediately\r\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n * after the current invocation finishes iff the current invocation would have\r\n * triggered another retry.\r\n */\n\n\nfunction stop(id) {\n  id(false);\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * @struct\r\n * @template T\r\n */\n\n\nvar NetworkRequest =\n/** @class */\nfunction () {\n  function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\n    var _this = this;\n\n    this.pendingXhr_ = null;\n    this.backoffId_ = null;\n    this.canceled_ = false;\n    this.appDelete_ = false;\n    this.url_ = url;\n    this.method_ = method;\n    this.headers_ = headers;\n    this.body_ = body;\n    this.successCodes_ = successCodes.slice();\n    this.additionalRetryCodes_ = additionalRetryCodes.slice();\n    this.callback_ = callback;\n    this.errorCallback_ = errorCallback;\n    this.progressCallback_ = progressCallback;\n    this.timeout_ = timeout;\n    this.pool_ = pool;\n    this.promise_ = new Promise(function (resolve, reject) {\n      _this.resolve_ = resolve;\n      _this.reject_ = reject;\n\n      _this.start_();\n    });\n  }\n  /**\r\n   * Actually starts the retry loop.\r\n   */\n\n\n  NetworkRequest.prototype.start_ = function () {\n    var self = this;\n\n    function doTheRequest(backoffCallback, canceled) {\n      if (canceled) {\n        backoffCallback(false, new RequestEndStatus(false, null, true));\n        return;\n      }\n\n      var xhr = self.pool_.createXhrIo();\n      self.pendingXhr_ = xhr;\n\n      function progressListener(progressEvent) {\n        var loaded = progressEvent.loaded;\n        var total = progressEvent.lengthComputable ? progressEvent.total : -1;\n\n        if (self.progressCallback_ !== null) {\n          self.progressCallback_(loaded, total);\n        }\n      }\n\n      if (self.progressCallback_ !== null) {\n        xhr.addUploadProgressListener(progressListener);\n      } // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n\n      xhr.send(self.url_, self.method_, self.body_, self.headers_).then(function (xhr) {\n        if (self.progressCallback_ !== null) {\n          xhr.removeUploadProgressListener(progressListener);\n        }\n\n        self.pendingXhr_ = null;\n        xhr = xhr;\n        var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\n        var status = xhr.getStatus();\n\n        if (!hitServer || self.isRetryStatusCode_(status)) {\n          var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\n          backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\n          return;\n        }\n\n        var successCode = self.successCodes_.indexOf(status) !== -1;\n        backoffCallback(true, new RequestEndStatus(successCode, xhr));\n      });\n    }\n    /**\r\n     * @param requestWentThrough True if the request eventually went\r\n     *     through, false if it hit the retry limit or was canceled.\r\n     */\n\n\n    function backoffDone(requestWentThrough, status) {\n      var resolve = self.resolve_;\n      var reject = self.reject_;\n      var xhr = status.xhr;\n\n      if (status.wasSuccessCode) {\n        try {\n          var result = self.callback_(xhr, xhr.getResponseText());\n\n          if (isJustDef(result)) {\n            resolve(result);\n          } else {\n            resolve();\n          }\n        } catch (e) {\n          reject(e);\n        }\n      } else {\n        if (xhr !== null) {\n          var err = unknown();\n          err.setServerResponseProp(xhr.getResponseText());\n\n          if (self.errorCallback_) {\n            reject(self.errorCallback_(xhr, err));\n          } else {\n            reject(err);\n          }\n        } else {\n          if (status.canceled) {\n            var err = self.appDelete_ ? appDeleted() : canceled();\n            reject(err);\n          } else {\n            var err = retryLimitExceeded();\n            reject(err);\n          }\n        }\n      }\n    }\n\n    if (this.canceled_) {\n      backoffDone(false, new RequestEndStatus(false, null, true));\n    } else {\n      this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\n    }\n  };\n  /** @inheritDoc */\n\n\n  NetworkRequest.prototype.getPromise = function () {\n    return this.promise_;\n  };\n  /** @inheritDoc */\n\n\n  NetworkRequest.prototype.cancel = function (appDelete) {\n    this.canceled_ = true;\n    this.appDelete_ = appDelete || false;\n\n    if (this.backoffId_ !== null) {\n      stop(this.backoffId_);\n    }\n\n    if (this.pendingXhr_ !== null) {\n      this.pendingXhr_.abort();\n    }\n  };\n\n  NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\n    // The codes for which to retry came from this page:\n    // https://cloud.google.com/storage/docs/exponential-backoff\n    var isFiveHundredCode = status >= 500 && status < 600;\n    var extraRetryCodes = [// Request Timeout: web server didn't receive full request in time.\n    408, // Too Many Requests: you're getting rate-limited, basically.\n    429];\n    var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\n    var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\n    return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\n  };\n\n  return NetworkRequest;\n}();\n/**\r\n * A collection of information about the result of a network request.\r\n * @param opt_canceled Defaults to false.\r\n * @struct\r\n */\n\n\nvar RequestEndStatus =\n/** @class */\nfunction () {\n  function RequestEndStatus(wasSuccessCode, xhr, canceled) {\n    this.wasSuccessCode = wasSuccessCode;\n    this.xhr = xhr;\n    this.canceled = !!canceled;\n  }\n\n  return RequestEndStatus;\n}();\n\nfunction addAuthHeader_(headers, authToken) {\n  if (authToken !== null && authToken.length > 0) {\n    headers['Authorization'] = 'Firebase ' + authToken;\n  }\n}\n\nfunction addVersionHeader_(headers) {\n  var version = typeof firebase !== 'undefined' ? firebase.SDK_VERSION : 'AppManager';\n  headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\n}\n\nfunction addGmpidHeader_(headers, appId) {\n  if (appId) {\n    headers['X-Firebase-GMPID'] = appId;\n  }\n}\n/**\r\n * @template T\r\n */\n\n\nfunction makeRequest(requestInfo, appId, authToken, pool) {\n  var queryPart = makeQueryString(requestInfo.urlParams);\n  var url = requestInfo.url + queryPart;\n  var headers = Object.assign({}, requestInfo.headers);\n  addGmpidHeader_(headers, appId);\n  addAuthHeader_(headers, authToken);\n  addVersionHeader_(headers);\n  return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\n}\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * A service that provides firebaseStorage.Reference instances.\r\n * @param opt_url gs:// url to a custom Storage Bucket\r\n *\r\n * @struct\r\n */\n\n\nvar StorageService =\n/** @class */\nfunction () {\n  function StorageService(app, authProvider, pool, url) {\n    var _a;\n\n    this.bucket_ = null;\n    this.appId_ = null;\n    this.deleted_ = false;\n    this.app_ = app;\n    this.authProvider_ = authProvider;\n    this.maxOperationRetryTime_ = DEFAULT_MAX_OPERATION_RETRY_TIME;\n    this.maxUploadRetryTime_ = DEFAULT_MAX_UPLOAD_RETRY_TIME;\n    this.requests_ = new Set();\n    this.pool_ = pool;\n\n    if (url != null) {\n      this.bucket_ = Location.makeFromBucketSpec(url);\n    } else {\n      this.bucket_ = StorageService.extractBucket_((_a = this.app_) === null || _a === void 0 ? void 0 : _a.options);\n    }\n\n    this.internals_ = new ServiceInternals(this);\n  }\n\n  StorageService.extractBucket_ = function (config) {\n    var bucketString = config === null || config === void 0 ? void 0 : config[CONFIG_STORAGE_BUCKET_KEY];\n\n    if (bucketString == null) {\n      return null;\n    }\n\n    return Location.makeFromBucketSpec(bucketString);\n  };\n\n  StorageService.prototype.getAuthToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var auth, tokenData;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            auth = this.authProvider_.getImmediate({\n              optional: true\n            });\n            if (!auth) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , auth.getToken()];\n\n          case 1:\n            tokenData = _a.sent();\n\n            if (tokenData !== null) {\n              return [2\n              /*return*/\n              , tokenData.accessToken];\n            }\n\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            , null];\n        }\n      });\n    });\n  };\n  /**\r\n   * Stop running requests and prevent more from being created.\r\n   */\n\n\n  StorageService.prototype.deleteApp = function () {\n    this.deleted_ = true;\n    this.app_ = null;\n    this.requests_.forEach(function (request) {\n      return request.cancel();\n    });\n    this.requests_.clear();\n  };\n  /**\r\n   * Returns a new firebaseStorage.Reference object referencing this StorageService\r\n   * at the given Location.\r\n   * @param loc The Location.\r\n   * @return A firebaseStorage.Reference.\r\n   */\n\n\n  StorageService.prototype.makeStorageReference = function (loc) {\n    return new Reference(this, loc);\n  };\n\n  StorageService.prototype.makeRequest = function (requestInfo, authToken) {\n    var _this = this;\n\n    if (!this.deleted_) {\n      var request_1 = makeRequest(requestInfo, this.appId_, authToken, this.pool_);\n      this.requests_.add(request_1); // Request removes itself from set when complete.\n\n      request_1.getPromise().then(function () {\n        return _this.requests_.delete(request_1);\n      }, function () {\n        return _this.requests_.delete(request_1);\n      });\n      return request_1;\n    } else {\n      return new FailRequest(appDeleted());\n    }\n  };\n  /**\r\n   * Returns a firebaseStorage.Reference for the given path in the default\r\n   * bucket.\r\n   */\n\n\n  StorageService.prototype.ref = function (path) {\n    function validator(path) {\n      if (typeof path !== 'string') {\n        throw 'Path is not a string.';\n      }\n\n      if (/^[A-Za-z]+:\\/\\//.test(path)) {\n        throw 'Expected child path but got a URL, use refFromURL instead.';\n      }\n    }\n\n    validate('ref', [stringSpec(validator, true)], arguments);\n\n    if (this.bucket_ == null) {\n      throw new Error('No Storage Bucket defined in Firebase Options.');\n    }\n\n    var ref = new Reference(this, this.bucket_);\n\n    if (path != null) {\n      return ref.child(path);\n    } else {\n      return ref;\n    }\n  };\n  /**\r\n   * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n   * which must be a gs:// or http[s]:// URL.\r\n   */\n\n\n  StorageService.prototype.refFromURL = function (url) {\n    function validator(p) {\n      if (typeof p !== 'string') {\n        throw 'Path is not a string.';\n      }\n\n      if (!/^[A-Za-z]+:\\/\\//.test(p)) {\n        throw 'Expected full URL but got a child path, use ref instead.';\n      }\n\n      try {\n        Location.makeFromUrl(p);\n      } catch (e) {\n        throw 'Expected valid full URL but got an invalid one.';\n      }\n    }\n\n    validate('refFromURL', [stringSpec(validator, false)], arguments);\n    return new Reference(this, url);\n  };\n\n  Object.defineProperty(StorageService.prototype, \"maxUploadRetryTime\", {\n    get: function () {\n      return this.maxUploadRetryTime_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StorageService.prototype.setMaxUploadRetryTime = function (time) {\n    validate('setMaxUploadRetryTime', [nonNegativeNumberSpec()], arguments);\n    this.maxUploadRetryTime_ = time;\n  };\n\n  Object.defineProperty(StorageService.prototype, \"maxOperationRetryTime\", {\n    get: function () {\n      return this.maxOperationRetryTime_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  StorageService.prototype.setMaxOperationRetryTime = function (time) {\n    validate('setMaxOperationRetryTime', [nonNegativeNumberSpec()], arguments);\n    this.maxOperationRetryTime_ = time;\n  };\n\n  Object.defineProperty(StorageService.prototype, \"app\", {\n    get: function () {\n      return this.app_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(StorageService.prototype, \"INTERNAL\", {\n    get: function () {\n      return this.internals_;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return StorageService;\n}();\n/**\r\n * @struct\r\n */\n\n\nvar ServiceInternals =\n/** @class */\nfunction () {\n  function ServiceInternals(service) {\n    this.service_ = service;\n  }\n  /**\r\n   * Called when the associated app is deleted.\r\n   */\n\n\n  ServiceInternals.prototype.delete = function () {\n    this.service_.deleteApp();\n    return Promise.resolve();\n  };\n\n  return ServiceInternals;\n}();\n\nvar name = \"@firebase/storage\";\nvar version = \"0.3.43\";\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Type constant for Firebase Storage.\r\n */\n\nvar STORAGE_TYPE = 'storage';\n\nfunction factory(container, url) {\n  // Dependencies\n  var app = container.getProvider('app').getImmediate();\n  var authProvider = container.getProvider('auth-internal');\n  return new StorageService(app, authProvider, new XhrIoPool(), url);\n}\n\nfunction registerStorage(instance) {\n  var namespaceExports = {\n    // no-inline\n    TaskState: TaskState,\n    TaskEvent: TaskEvent,\n    StringFormat: StringFormat,\n    Storage: StorageService,\n    Reference: Reference\n  };\n  instance.INTERNAL.registerComponent(new Component(STORAGE_TYPE, factory, \"PUBLIC\"\n  /* PUBLIC */\n  ).setServiceProps(namespaceExports).setMultipleInstances(true));\n  instance.registerVersion(name, version);\n}\n\nregisterStorage(firebase);\nexport { registerStorage };","map":{"version":3,"sources":["/Users/shaunteeshad/__apps/luminous-dashboard/node_modules/@firebase/storage/dist/index.esm.js"],"names":["firebase","__awaiter","__generator","__spreadArrays","Component","DEFAULT_HOST","CONFIG_STORAGE_BUCKET_KEY","DEFAULT_MAX_OPERATION_RETRY_TIME","DEFAULT_MAX_UPLOAD_RETRY_TIME","FirebaseStorageError","code","message","code_","prependCode","message_","serverResponse_","name_","prototype","codeProp","codeEquals","serverResponseProp","setServerResponseProp","serverResponse","Object","defineProperty","get","enumerable","configurable","Code","UNKNOWN","OBJECT_NOT_FOUND","BUCKET_NOT_FOUND","PROJECT_NOT_FOUND","QUOTA_EXCEEDED","UNAUTHENTICATED","UNAUTHORIZED","RETRY_LIMIT_EXCEEDED","INVALID_CHECKSUM","CANCELED","INVALID_EVENT_NAME","INVALID_URL","INVALID_DEFAULT_BUCKET","NO_DEFAULT_BUCKET","CANNOT_SLICE_BLOB","SERVER_FILE_WRONG_SIZE","NO_DOWNLOAD_URL","INVALID_ARGUMENT","INVALID_ARGUMENT_COUNT","APP_DELETED","INVALID_ROOT_OPERATION","INVALID_FORMAT","INTERNAL_ERROR","unknown","objectNotFound","path","quotaExceeded","bucket","unauthenticated","unauthorized","retryLimitExceeded","canceled","invalidUrl","url","invalidDefaultBucket","cannotSliceBlob","serverFileWrongSize","noDownloadURL","invalidArgument","index","fnName","invalidArgumentCount","argMin","argMax","real","countPart","plural","appDeleted","invalidRootOperation","name","invalidFormat","format","internalError","StringFormat","RAW","BASE64","BASE64URL","DATA_URL","formatValidator","stringFormat","StringData","data","contentType","dataFromString","stringData","utf8Bytes_","base64Bytes_","dataURLBytes_","dataURLContentType_","value","b","i","length","c","charCodeAt","push","valid","hi","lo","Uint8Array","percentEncodedBytes_","decoded","decodeURIComponent","e","hasMinus","indexOf","hasUnder","invalidChar","hasPlus","hasSlash","replace","bytes","atob","array","DataURLParts","dataURL","base64","matches","match","middle","endsWith","substring","rest","dataUrl","parts","s","end","longEnough","TaskEvent","STATE_CHANGED","InternalTaskState","RUNNING","PAUSING","PAUSED","SUCCESS","CANCELING","ERROR","TaskState","taskStateFromInternalTaskState","state","isDef","p","isJustDef","isFunction","isObject","isNonNullObject","isNonArrayObject","Array","isArray","isString","String","isInteger","isNumber","Number","isNativeBlob","isNativeBlobDefined","Blob","ErrorCode","NetworkXhrIo","_this","sent_","xhr_","XMLHttpRequest","errorCode_","NO_ERROR","sendPromise_","Promise","resolve","addEventListener","ABORT","NETWORK_ERROR","send","method","body","headers","open","key","hasOwnProperty","setRequestHeader","toString","getErrorCode","getStatus","status","getResponseText","responseText","abort","getResponseHeader","header","addUploadProgressListener","listener","upload","removeUploadProgressListener","removeEventListener","XhrIoPool","createXhrIo","getBlobBuilder","BlobBuilder","WebKitBlobBuilder","undefined","getBlob","args","_i","arguments","bb","append","Error","sliceBlob","blob","start","webkitSlice","mozSlice","slice","FbsBlob","elideCopy","size","blobType","data_","type","ArrayBuffer","byteLength","set","size_","type_","startByte","endByte","realBlob","sliced","buffer","blobby","map","val","apply","uint8Arrays","finalLength_1","forEach","merged_1","index_1","uploadData","Location","path_","fullServerUrl","encode","encodeURIComponent","bucketOnlyServerUrl","makeFromBucketSpec","bucketString","bucketLocation","makeFromUrl","location","bucketDomain","gsModify","loc","charAt","gsPath","gsRegex","RegExp","gsIndices","httpModify","version","firebaseStorageHost","firebaseStoragePath","firebaseStorageRegExp","firebaseStorageIndices","cloudStorageHost","cloudStoragePath","cloudStorageRegExp","cloudStorageIndices","groups","regex","indices","postModify","group","captures","exec","bucketValue","pathValue","jsonObjectOrNull","obj","JSON","parse","parent","lastIndexOf","newPath","child","childPath","canonicalChildPath","split","filter","component","join","lastComponent","makeUrl","urlPart","makeQueryString","params","queryPart","nextPart","noXform_","metadata","Mapping","server","local","writable","xform","mappings_","xformPath","fullPath","getMappings","mappings","mappingsXformPath","_metadata","nameMapping","xformSize","sizeMapping","addRef","service","generateRef","makeStorageReference","fromResource","resource","len","mapping","fromResourceString","resourceString","downloadUrlFromResourceString","tokens","tokensList","urls","token","base","queryString","alt","toResourceString","stringify","metadataValidator","MAX_RESULTS_KEY","MAX_MAX_RESULTS","PAGE_TOKEN_KEY","PREFIXES_KEY","ITEMS_KEY","fromBackendResponse","listResult","prefixes","items","nextPageToken","_a","pathWithoutTrailingSlash","reference","_b","_c","item","fromResponseString","listOptionsValidator","RequestInfo","handler","timeout","urlParams","errorHandler","progressCallback","successCodes","additionalRetryCodes","handlerCheck","cndn","metadataHandler","xhr","text","listHandler","downloadUrlHandler","sharedErrorHandler","err","newErr","objectErrorHandler","shared","getMetadata","maxOperationRetryTime","requestInfo","list","delimiter","pageToken","maxResults","isRoot","getDownloadUrl","updateMetadata","deleteObject","_xhr","_text","determineContentType_","metadataForUpload_","metadataClone","assign","multipartUpload","genBoundary","str","Math","random","boundary","metadata_","metadataString","preBlobPart","postBlobPart","maxUploadRetryTime","ResumableUploadStatus","current","total","finalized","checkResumeHeader_","allowed","allowedStatus","createResumableUpload","metadataForUpload","getResumableUploadStatus","sizeString","isNaN","resumableUploadChunkSize","continueResumableUpload","chunkSize","status_","bytesLeft","bytesToUpload","min","uploadCommand","uploadStatus","newCurrent","Observer","nextOrObserver","error","complete","asFunctions","next","observer","UploadTaskSnapshot","bytesTransferred","totalBytes","task","ref","validate","specs","passed","minArgs","maxArgs","optional","validLength","validator","ArgSpec","self","and_","v1","v2","stringSpec","stringValidator","chainedValidator","uploadDataSpec","metadataSpec","listOptionSpec","nonNegativeNumberSpec","looseObjectSpec","isLooseObjectValidator","isLooseObject","nullFunctionSpec","async","f","argsToForward","then","UploadTask","transferred_","needToFetchStatus_","needToFetchMetadata_","observers_","error_","uploadUrl_","request_","chunkMultiplier_","resolve_","reject_","ref_","service_","location_","blob_","resumable_","shouldDoResumable_","state_","errorHandler_","completeTransitions_","transition_","metadataErrorHandler_","promise_","reject","start_","makeProgressCallback_","sizeBefore","loaded","updateProgress_","createResumable_","fetchStatus_","fetchMetadata_","continueUpload_","oneShotUpload_","resolveToken_","callback","getAuthToken","authToken","createRequest","makeRequest","getPromise","statusRequest","uploadRequest","newStatus","increaseMultiplier_","currentSize","metadataRequest","multipartRequest","transferred","old","notifyObservers_","cancel","wasPaused","externalState","on","completed","typeValidator","nextOrObserverMessage","nextValidator","observerValidator","nextOrObserverValidator","anyDefined","makeBinder","binder","addObserver_","removeObserver_","binderNextOrObserverValidator","binderSpecs","typeOnly","onFulfilled","onRejected","catch","notifyObserver_","splice","finishPromise_","observers","triggered","bind","snapshot","toCall","resume","pause","Reference","newRef","put","throwIfRoot_","putString","delete","listAll","accumulator","listAllHelper","opt","nextPage","label","sent","options","op","getDownloadURL","FailRequest","_appDelete","waitSeconds","timeoutId","hitTimeout","cancelState","triggeredCallback","triggerCallback","callWithDelay","millis","setTimeout","success","call","mustStop","waitMillis","stopped","stop","wasTimeout","clearTimeout","id","NetworkRequest","errorCallback","pool","pendingXhr_","backoffId_","canceled_","appDelete_","url_","method_","headers_","body_","successCodes_","additionalRetryCodes_","callback_","errorCallback_","progressCallback_","timeout_","pool_","doTheRequest","backoffCallback","RequestEndStatus","progressListener","progressEvent","lengthComputable","hitServer","isRetryStatusCode_","wasCanceled","successCode","backoffDone","requestWentThrough","wasSuccessCode","result","appDelete","isFiveHundredCode","extraRetryCodes","isExtraRetryCode","isRequestSpecificRetryCode","addAuthHeader_","addVersionHeader_","SDK_VERSION","addGmpidHeader_","appId","StorageService","app","authProvider","bucket_","appId_","deleted_","app_","authProvider_","maxOperationRetryTime_","maxUploadRetryTime_","requests_","Set","extractBucket_","internals_","ServiceInternals","config","auth","tokenData","getImmediate","getToken","accessToken","deleteApp","request","clear","request_1","add","test","refFromURL","setMaxUploadRetryTime","time","setMaxOperationRetryTime","STORAGE_TYPE","factory","container","getProvider","registerStorage","instance","namespaceExports","Storage","INTERNAL","registerComponent","setServiceProps","setMultipleInstances","registerVersion"],"mappings":"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","sourcesContent":["import firebase from '@firebase/app';\nimport { __awaiter, __generator, __spreadArrays } from 'tslib';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Constants used in the Firebase Storage library.\r\n */\r\n/**\r\n * Domain name for firebase storage.\r\n */\r\nvar DEFAULT_HOST = 'firebasestorage.googleapis.com';\r\n/**\r\n * The key in Firebase config json for the storage bucket.\r\n */\r\nvar CONFIG_STORAGE_BUCKET_KEY = 'storageBucket';\r\n/**\r\n * 2 minutes\r\n *\r\n * The timeout for all operations except upload.\r\n */\r\nvar DEFAULT_MAX_OPERATION_RETRY_TIME = 2 * 60 * 1000;\r\n/**\r\n * 10 minutes\r\n *\r\n * The timeout for upload.\r\n */\r\nvar DEFAULT_MAX_UPLOAD_RETRY_TIME = 10 * 60 * 1000;\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FirebaseStorageError = /** @class */ (function () {\r\n    function FirebaseStorageError(code, message) {\r\n        this.code_ = prependCode(code);\r\n        this.message_ = 'Firebase Storage: ' + message;\r\n        this.serverResponse_ = null;\r\n        this.name_ = 'FirebaseError';\r\n    }\r\n    FirebaseStorageError.prototype.codeProp = function () {\r\n        return this.code;\r\n    };\r\n    FirebaseStorageError.prototype.codeEquals = function (code) {\r\n        return prependCode(code) === this.codeProp();\r\n    };\r\n    FirebaseStorageError.prototype.serverResponseProp = function () {\r\n        return this.serverResponse_;\r\n    };\r\n    FirebaseStorageError.prototype.setServerResponseProp = function (serverResponse) {\r\n        this.serverResponse_ = serverResponse;\r\n    };\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"name\", {\r\n        get: function () {\r\n            return this.name_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"code\", {\r\n        get: function () {\r\n            return this.code_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"message\", {\r\n        get: function () {\r\n            if (this.serverResponse_) {\r\n                return this.message_ + '\\n' + this.serverResponse_;\r\n            }\r\n            else {\r\n                return this.message_;\r\n            }\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(FirebaseStorageError.prototype, \"serverResponse\", {\r\n        get: function () {\r\n            return this.serverResponse_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return FirebaseStorageError;\r\n}());\r\nvar Code = {\r\n    // Shared between all platforms\r\n    UNKNOWN: 'unknown',\r\n    OBJECT_NOT_FOUND: 'object-not-found',\r\n    BUCKET_NOT_FOUND: 'bucket-not-found',\r\n    PROJECT_NOT_FOUND: 'project-not-found',\r\n    QUOTA_EXCEEDED: 'quota-exceeded',\r\n    UNAUTHENTICATED: 'unauthenticated',\r\n    UNAUTHORIZED: 'unauthorized',\r\n    RETRY_LIMIT_EXCEEDED: 'retry-limit-exceeded',\r\n    INVALID_CHECKSUM: 'invalid-checksum',\r\n    CANCELED: 'canceled',\r\n    // JS specific\r\n    INVALID_EVENT_NAME: 'invalid-event-name',\r\n    INVALID_URL: 'invalid-url',\r\n    INVALID_DEFAULT_BUCKET: 'invalid-default-bucket',\r\n    NO_DEFAULT_BUCKET: 'no-default-bucket',\r\n    CANNOT_SLICE_BLOB: 'cannot-slice-blob',\r\n    SERVER_FILE_WRONG_SIZE: 'server-file-wrong-size',\r\n    NO_DOWNLOAD_URL: 'no-download-url',\r\n    INVALID_ARGUMENT: 'invalid-argument',\r\n    INVALID_ARGUMENT_COUNT: 'invalid-argument-count',\r\n    APP_DELETED: 'app-deleted',\r\n    INVALID_ROOT_OPERATION: 'invalid-root-operation',\r\n    INVALID_FORMAT: 'invalid-format',\r\n    INTERNAL_ERROR: 'internal-error'\r\n};\r\nfunction prependCode(code) {\r\n    return 'storage/' + code;\r\n}\r\nfunction unknown() {\r\n    var message = 'An unknown error occurred, please check the error payload for ' +\r\n        'server response.';\r\n    return new FirebaseStorageError(Code.UNKNOWN, message);\r\n}\r\nfunction objectNotFound(path) {\r\n    return new FirebaseStorageError(Code.OBJECT_NOT_FOUND, \"Object '\" + path + \"' does not exist.\");\r\n}\r\nfunction quotaExceeded(bucket) {\r\n    return new FirebaseStorageError(Code.QUOTA_EXCEEDED, \"Quota for bucket '\" +\r\n        bucket +\r\n        \"' exceeded, please view quota on \" +\r\n        'https://firebase.google.com/pricing/.');\r\n}\r\nfunction unauthenticated() {\r\n    var message = 'User is not authenticated, please authenticate using Firebase ' +\r\n        'Authentication and try again.';\r\n    return new FirebaseStorageError(Code.UNAUTHENTICATED, message);\r\n}\r\nfunction unauthorized(path) {\r\n    return new FirebaseStorageError(Code.UNAUTHORIZED, \"User does not have permission to access '\" + path + \"'.\");\r\n}\r\nfunction retryLimitExceeded() {\r\n    return new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED, 'Max retry time for operation exceeded, please try again.');\r\n}\r\nfunction canceled() {\r\n    return new FirebaseStorageError(Code.CANCELED, 'User canceled the upload/download.');\r\n}\r\nfunction invalidUrl(url) {\r\n    return new FirebaseStorageError(Code.INVALID_URL, \"Invalid URL '\" + url + \"'.\");\r\n}\r\nfunction invalidDefaultBucket(bucket) {\r\n    return new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET, \"Invalid default bucket '\" + bucket + \"'.\");\r\n}\r\nfunction cannotSliceBlob() {\r\n    return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB, 'Cannot slice blob for upload. Please retry the upload.');\r\n}\r\nfunction serverFileWrongSize() {\r\n    return new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE, 'Server recorded incorrect upload file size, please retry the upload.');\r\n}\r\nfunction noDownloadURL() {\r\n    return new FirebaseStorageError(Code.NO_DOWNLOAD_URL, 'The given file does not have any download URLs.');\r\n}\r\nfunction invalidArgument(index, fnName, message) {\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT, 'Invalid argument in `' + fnName + '` at index ' + index + ': ' + message);\r\n}\r\nfunction invalidArgumentCount(argMin, argMax, fnName, real) {\r\n    var countPart;\r\n    var plural;\r\n    if (argMin === argMax) {\r\n        countPart = argMin;\r\n        plural = argMin === 1 ? 'argument' : 'arguments';\r\n    }\r\n    else {\r\n        countPart = 'between ' + argMin + ' and ' + argMax;\r\n        plural = 'arguments';\r\n    }\r\n    return new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT, 'Invalid argument count in `' +\r\n        fnName +\r\n        '`: Expected ' +\r\n        countPart +\r\n        ' ' +\r\n        plural +\r\n        ', received ' +\r\n        real +\r\n        '.');\r\n}\r\nfunction appDeleted() {\r\n    return new FirebaseStorageError(Code.APP_DELETED, 'The Firebase app was deleted.');\r\n}\r\n/**\r\n * @param name The name of the operation that was invalid.\r\n */\r\nfunction invalidRootOperation(name) {\r\n    return new FirebaseStorageError(Code.INVALID_ROOT_OPERATION, \"The operation '\" +\r\n        name +\r\n        \"' cannot be performed on a root reference, create a non-root \" +\r\n        \"reference using child, such as .child('file.png').\");\r\n}\r\n/**\r\n * @param format The format that was not valid.\r\n * @param message A message describing the format violation.\r\n */\r\nfunction invalidFormat(format, message) {\r\n    return new FirebaseStorageError(Code.INVALID_FORMAT, \"String does not match format '\" + format + \"': \" + message);\r\n}\r\n/**\r\n * @param message A message describing the internal error.\r\n */\r\nfunction internalError(message) {\r\n    throw new FirebaseStorageError(Code.INTERNAL_ERROR, 'Internal error: ' + message);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar StringFormat = {\r\n    RAW: 'raw',\r\n    BASE64: 'base64',\r\n    BASE64URL: 'base64url',\r\n    DATA_URL: 'data_url'\r\n};\r\nfunction formatValidator(stringFormat) {\r\n    switch (stringFormat) {\r\n        case StringFormat.RAW:\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n        case StringFormat.DATA_URL:\r\n            return;\r\n        default:\r\n            throw ('Expected one of the event types: [' +\r\n                StringFormat.RAW +\r\n                ', ' +\r\n                StringFormat.BASE64 +\r\n                ', ' +\r\n                StringFormat.BASE64URL +\r\n                ', ' +\r\n                StringFormat.DATA_URL +\r\n                '].');\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar StringData = /** @class */ (function () {\r\n    function StringData(data, contentType) {\r\n        this.data = data;\r\n        this.contentType = contentType || null;\r\n    }\r\n    return StringData;\r\n}());\r\nfunction dataFromString(format, stringData) {\r\n    switch (format) {\r\n        case StringFormat.RAW:\r\n            return new StringData(utf8Bytes_(stringData));\r\n        case StringFormat.BASE64:\r\n        case StringFormat.BASE64URL:\r\n            return new StringData(base64Bytes_(format, stringData));\r\n        case StringFormat.DATA_URL:\r\n            return new StringData(dataURLBytes_(stringData), dataURLContentType_(stringData));\r\n        // do nothing\r\n    }\r\n    // assert(false);\r\n    throw unknown();\r\n}\r\nfunction utf8Bytes_(value) {\r\n    var b = [];\r\n    for (var i = 0; i < value.length; i++) {\r\n        var c = value.charCodeAt(i);\r\n        if (c <= 127) {\r\n            b.push(c);\r\n        }\r\n        else {\r\n            if (c <= 2047) {\r\n                b.push(192 | (c >> 6), 128 | (c & 63));\r\n            }\r\n            else {\r\n                if ((c & 64512) === 55296) {\r\n                    // The start of a surrogate pair.\r\n                    var valid = i < value.length - 1 && (value.charCodeAt(i + 1) & 64512) === 56320;\r\n                    if (!valid) {\r\n                        // The second surrogate wasn't there.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        var hi = c;\r\n                        var lo = value.charCodeAt(++i);\r\n                        c = 65536 | ((hi & 1023) << 10) | (lo & 1023);\r\n                        b.push(240 | (c >> 18), 128 | ((c >> 12) & 63), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n                else {\r\n                    if ((c & 64512) === 56320) {\r\n                        // Invalid low surrogate.\r\n                        b.push(239, 191, 189);\r\n                    }\r\n                    else {\r\n                        b.push(224 | (c >> 12), 128 | ((c >> 6) & 63), 128 | (c & 63));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return new Uint8Array(b);\r\n}\r\nfunction percentEncodedBytes_(value) {\r\n    var decoded;\r\n    try {\r\n        decoded = decodeURIComponent(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(StringFormat.DATA_URL, 'Malformed data URL.');\r\n    }\r\n    return utf8Bytes_(decoded);\r\n}\r\nfunction base64Bytes_(format, value) {\r\n    switch (format) {\r\n        case StringFormat.BASE64: {\r\n            var hasMinus = value.indexOf('-') !== -1;\r\n            var hasUnder = value.indexOf('_') !== -1;\r\n            if (hasMinus || hasUnder) {\r\n                var invalidChar = hasMinus ? '-' : '_';\r\n                throw invalidFormat(format, \"Invalid character '\" +\r\n                    invalidChar +\r\n                    \"' found: is it base64url encoded?\");\r\n            }\r\n            break;\r\n        }\r\n        case StringFormat.BASE64URL: {\r\n            var hasPlus = value.indexOf('+') !== -1;\r\n            var hasSlash = value.indexOf('/') !== -1;\r\n            if (hasPlus || hasSlash) {\r\n                var invalidChar = hasPlus ? '+' : '/';\r\n                throw invalidFormat(format, \"Invalid character '\" + invalidChar + \"' found: is it base64 encoded?\");\r\n            }\r\n            value = value.replace(/-/g, '+').replace(/_/g, '/');\r\n            break;\r\n        }\r\n        // do nothing\r\n    }\r\n    var bytes;\r\n    try {\r\n        bytes = atob(value);\r\n    }\r\n    catch (e) {\r\n        throw invalidFormat(format, 'Invalid character found');\r\n    }\r\n    var array = new Uint8Array(bytes.length);\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        array[i] = bytes.charCodeAt(i);\r\n    }\r\n    return array;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar DataURLParts = /** @class */ (function () {\r\n    function DataURLParts(dataURL) {\r\n        this.base64 = false;\r\n        this.contentType = null;\r\n        var matches = dataURL.match(/^data:([^,]+)?,/);\r\n        if (matches === null) {\r\n            throw invalidFormat(StringFormat.DATA_URL, \"Must be formatted 'data:[<mediatype>][;base64],<data>\");\r\n        }\r\n        var middle = matches[1] || null;\r\n        if (middle != null) {\r\n            this.base64 = endsWith(middle, ';base64');\r\n            this.contentType = this.base64\r\n                ? middle.substring(0, middle.length - ';base64'.length)\r\n                : middle;\r\n        }\r\n        this.rest = dataURL.substring(dataURL.indexOf(',') + 1);\r\n    }\r\n    return DataURLParts;\r\n}());\r\nfunction dataURLBytes_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    if (parts.base64) {\r\n        return base64Bytes_(StringFormat.BASE64, parts.rest);\r\n    }\r\n    else {\r\n        return percentEncodedBytes_(parts.rest);\r\n    }\r\n}\r\nfunction dataURLContentType_(dataUrl) {\r\n    var parts = new DataURLParts(dataUrl);\r\n    return parts.contentType;\r\n}\r\nfunction endsWith(s, end) {\r\n    var longEnough = s.length >= end.length;\r\n    if (!longEnough) {\r\n        return false;\r\n    }\r\n    return s.substring(s.length - end.length) === end;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TaskEvent = {\r\n    /** Triggered whenever the task changes or progress is updated. */\r\n    STATE_CHANGED: 'state_changed'\r\n};\r\nvar InternalTaskState = {\r\n    RUNNING: 'running',\r\n    PAUSING: 'pausing',\r\n    PAUSED: 'paused',\r\n    SUCCESS: 'success',\r\n    CANCELING: 'canceling',\r\n    CANCELED: 'canceled',\r\n    ERROR: 'error'\r\n};\r\nvar TaskState = {\r\n    /** The task is currently transferring data. */\r\n    RUNNING: 'running',\r\n    /** The task was paused by the user. */\r\n    PAUSED: 'paused',\r\n    /** The task completed successfully. */\r\n    SUCCESS: 'success',\r\n    /** The task was canceled. */\r\n    CANCELED: 'canceled',\r\n    /** The task failed with an error. */\r\n    ERROR: 'error'\r\n};\r\nfunction taskStateFromInternalTaskState(state) {\r\n    switch (state) {\r\n        case InternalTaskState.RUNNING:\r\n        case InternalTaskState.PAUSING:\r\n        case InternalTaskState.CANCELING:\r\n            return TaskState.RUNNING;\r\n        case InternalTaskState.PAUSED:\r\n            return TaskState.PAUSED;\r\n        case InternalTaskState.SUCCESS:\r\n            return TaskState.SUCCESS;\r\n        case InternalTaskState.CANCELED:\r\n            return TaskState.CANCELED;\r\n        case InternalTaskState.ERROR:\r\n            return TaskState.ERROR;\r\n        default:\r\n            // TODO(andysoto): assert(false);\r\n            return TaskState.ERROR;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @return False if the object is undefined or null, true otherwise.\r\n */\r\nfunction isDef(p) {\r\n    return p != null;\r\n}\r\nfunction isJustDef(p) {\r\n    return p !== void 0;\r\n}\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction isFunction(p) {\r\n    return typeof p === 'function';\r\n}\r\nfunction isObject(p) {\r\n    return typeof p === 'object';\r\n}\r\nfunction isNonNullObject(p) {\r\n    return isObject(p) && p !== null;\r\n}\r\nfunction isNonArrayObject(p) {\r\n    return isObject(p) && !Array.isArray(p);\r\n}\r\nfunction isString(p) {\r\n    return typeof p === 'string' || p instanceof String;\r\n}\r\nfunction isInteger(p) {\r\n    return isNumber(p) && Number.isInteger(p);\r\n}\r\nfunction isNumber(p) {\r\n    return typeof p === 'number' || p instanceof Number;\r\n}\r\nfunction isNativeBlob(p) {\r\n    return isNativeBlobDefined() && p instanceof Blob;\r\n}\r\nfunction isNativeBlobDefined() {\r\n    return typeof Blob !== 'undefined';\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @enum{number}\r\n */\r\nvar ErrorCode;\r\n(function (ErrorCode) {\r\n    ErrorCode[ErrorCode[\"NO_ERROR\"] = 0] = \"NO_ERROR\";\r\n    ErrorCode[ErrorCode[\"NETWORK_ERROR\"] = 1] = \"NETWORK_ERROR\";\r\n    ErrorCode[ErrorCode[\"ABORT\"] = 2] = \"ABORT\";\r\n})(ErrorCode || (ErrorCode = {}));\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * We use this instead of goog.net.XhrIo because goog.net.XhrIo is hyuuuuge and\r\n * doesn't work in React Native on Android.\r\n */\r\nvar NetworkXhrIo = /** @class */ (function () {\r\n    function NetworkXhrIo() {\r\n        var _this = this;\r\n        this.sent_ = false;\r\n        this.xhr_ = new XMLHttpRequest();\r\n        this.errorCode_ = ErrorCode.NO_ERROR;\r\n        this.sendPromise_ = new Promise(function (resolve) {\r\n            _this.xhr_.addEventListener('abort', function () {\r\n                _this.errorCode_ = ErrorCode.ABORT;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('error', function () {\r\n                _this.errorCode_ = ErrorCode.NETWORK_ERROR;\r\n                resolve(_this);\r\n            });\r\n            _this.xhr_.addEventListener('load', function () {\r\n                resolve(_this);\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.send = function (url, method, body, headers) {\r\n        if (this.sent_) {\r\n            throw internalError('cannot .send() more than once');\r\n        }\r\n        this.sent_ = true;\r\n        this.xhr_.open(method, url, true);\r\n        if (isDef(headers)) {\r\n            for (var key in headers) {\r\n                if (headers.hasOwnProperty(key)) {\r\n                    this.xhr_.setRequestHeader(key, headers[key].toString());\r\n                }\r\n            }\r\n        }\r\n        if (isDef(body)) {\r\n            this.xhr_.send(body);\r\n        }\r\n        else {\r\n            this.xhr_.send();\r\n        }\r\n        return this.sendPromise_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getErrorCode = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getErrorCode() before sending');\r\n        }\r\n        return this.errorCode_;\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getStatus = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getStatus() before sending');\r\n        }\r\n        try {\r\n            return this.xhr_.status;\r\n        }\r\n        catch (e) {\r\n            return -1;\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseText = function () {\r\n        if (!this.sent_) {\r\n            throw internalError('cannot .getResponseText() before sending');\r\n        }\r\n        return this.xhr_.responseText;\r\n    };\r\n    /**\r\n     * Aborts the request.\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.abort = function () {\r\n        this.xhr_.abort();\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.getResponseHeader = function (header) {\r\n        return this.xhr_.getResponseHeader(header);\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.addUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.addEventListener('progress', listener);\r\n        }\r\n    };\r\n    /**\r\n     * @override\r\n     */\r\n    NetworkXhrIo.prototype.removeUploadProgressListener = function (listener) {\r\n        if (isDef(this.xhr_.upload)) {\r\n            this.xhr_.upload.removeEventListener('progress', listener);\r\n        }\r\n    };\r\n    return NetworkXhrIo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Factory-like class for creating XhrIo instances.\r\n */\r\nvar XhrIoPool = /** @class */ (function () {\r\n    function XhrIoPool() {\r\n    }\r\n    XhrIoPool.prototype.createXhrIo = function () {\r\n        return new NetworkXhrIo();\r\n    };\r\n    return XhrIoPool;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getBlobBuilder() {\r\n    if (typeof BlobBuilder !== 'undefined') {\r\n        return BlobBuilder;\r\n    }\r\n    else if (typeof WebKitBlobBuilder !== 'undefined') {\r\n        return WebKitBlobBuilder;\r\n    }\r\n    else {\r\n        return undefined;\r\n    }\r\n}\r\n/**\r\n * Concatenates one or more values together and converts them to a Blob.\r\n *\r\n * @param args The values that will make up the resulting blob.\r\n * @return The blob.\r\n */\r\nfunction getBlob() {\r\n    var args = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        args[_i] = arguments[_i];\r\n    }\r\n    var BlobBuilder = getBlobBuilder();\r\n    if (BlobBuilder !== undefined) {\r\n        var bb = new BlobBuilder();\r\n        for (var i = 0; i < args.length; i++) {\r\n            bb.append(args[i]);\r\n        }\r\n        return bb.getBlob();\r\n    }\r\n    else {\r\n        if (isNativeBlobDefined()) {\r\n            return new Blob(args);\r\n        }\r\n        else {\r\n            throw Error(\"This browser doesn't seem to support creating Blobs\");\r\n        }\r\n    }\r\n}\r\n/**\r\n * Slices the blob. The returned blob contains data from the start byte\r\n * (inclusive) till the end byte (exclusive). Negative indices cannot be used.\r\n *\r\n * @param blob The blob to be sliced.\r\n * @param start Index of the starting byte.\r\n * @param end Index of the ending byte.\r\n * @return The blob slice or null if not supported.\r\n */\r\nfunction sliceBlob(blob, start, end) {\r\n    if (blob.webkitSlice) {\r\n        return blob.webkitSlice(start, end);\r\n    }\r\n    else if (blob.mozSlice) {\r\n        return blob.mozSlice(start, end);\r\n    }\r\n    else if (blob.slice) {\r\n        return blob.slice(start, end);\r\n    }\r\n    return null;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param opt_elideCopy If true, doesn't copy mutable input data\r\n *     (e.g. Uint8Arrays). Pass true only if you know the objects will not be\r\n *     modified after this blob's construction.\r\n */\r\nvar FbsBlob = /** @class */ (function () {\r\n    function FbsBlob(data, elideCopy) {\r\n        var size = 0;\r\n        var blobType = '';\r\n        if (isNativeBlob(data)) {\r\n            this.data_ = data;\r\n            size = data.size;\r\n            blobType = data.type;\r\n        }\r\n        else if (data instanceof ArrayBuffer) {\r\n            if (elideCopy) {\r\n                this.data_ = new Uint8Array(data);\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.byteLength);\r\n                this.data_.set(new Uint8Array(data));\r\n            }\r\n            size = this.data_.length;\r\n        }\r\n        else if (data instanceof Uint8Array) {\r\n            if (elideCopy) {\r\n                this.data_ = data;\r\n            }\r\n            else {\r\n                this.data_ = new Uint8Array(data.length);\r\n                this.data_.set(data);\r\n            }\r\n            size = data.length;\r\n        }\r\n        this.size_ = size;\r\n        this.type_ = blobType;\r\n    }\r\n    FbsBlob.prototype.size = function () {\r\n        return this.size_;\r\n    };\r\n    FbsBlob.prototype.type = function () {\r\n        return this.type_;\r\n    };\r\n    FbsBlob.prototype.slice = function (startByte, endByte) {\r\n        if (isNativeBlob(this.data_)) {\r\n            var realBlob = this.data_;\r\n            var sliced = sliceBlob(realBlob, startByte, endByte);\r\n            if (sliced === null) {\r\n                return null;\r\n            }\r\n            return new FbsBlob(sliced);\r\n        }\r\n        else {\r\n            var slice = new Uint8Array(this.data_.buffer, startByte, endByte - startByte);\r\n            return new FbsBlob(slice, true);\r\n        }\r\n    };\r\n    FbsBlob.getBlob = function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (isNativeBlobDefined()) {\r\n            var blobby = args.map(function (val) {\r\n                if (val instanceof FbsBlob) {\r\n                    return val.data_;\r\n                }\r\n                else {\r\n                    return val;\r\n                }\r\n            });\r\n            return new FbsBlob(getBlob.apply(null, blobby));\r\n        }\r\n        else {\r\n            var uint8Arrays = args.map(function (val) {\r\n                if (isString(val)) {\r\n                    return dataFromString(StringFormat.RAW, val).data;\r\n                }\r\n                else {\r\n                    // Blobs don't exist, so this has to be a Uint8Array.\r\n                    return val.data_;\r\n                }\r\n            });\r\n            var finalLength_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                finalLength_1 += array.byteLength;\r\n            });\r\n            var merged_1 = new Uint8Array(finalLength_1);\r\n            var index_1 = 0;\r\n            uint8Arrays.forEach(function (array) {\r\n                for (var i = 0; i < array.length; i++) {\r\n                    merged_1[index_1++] = array[i];\r\n                }\r\n            });\r\n            return new FbsBlob(merged_1, true);\r\n        }\r\n    };\r\n    FbsBlob.prototype.uploadData = function () {\r\n        return this.data_;\r\n    };\r\n    return FbsBlob;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Location = /** @class */ (function () {\r\n    function Location(bucket, path) {\r\n        this.bucket = bucket;\r\n        this.path_ = path;\r\n    }\r\n    Object.defineProperty(Location.prototype, \"path\", {\r\n        get: function () {\r\n            return this.path_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Location.prototype, \"isRoot\", {\r\n        get: function () {\r\n            return this.path.length === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Location.prototype.fullServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o/' + encode(this.path);\r\n    };\r\n    Location.prototype.bucketOnlyServerUrl = function () {\r\n        var encode = encodeURIComponent;\r\n        return '/b/' + encode(this.bucket) + '/o';\r\n    };\r\n    Location.makeFromBucketSpec = function (bucketString) {\r\n        var bucketLocation;\r\n        try {\r\n            bucketLocation = Location.makeFromUrl(bucketString);\r\n        }\r\n        catch (e) {\r\n            // Not valid URL, use as-is. This lets you put bare bucket names in\r\n            // config.\r\n            return new Location(bucketString, '');\r\n        }\r\n        if (bucketLocation.path === '') {\r\n            return bucketLocation;\r\n        }\r\n        else {\r\n            throw invalidDefaultBucket(bucketString);\r\n        }\r\n    };\r\n    Location.makeFromUrl = function (url) {\r\n        var location = null;\r\n        var bucketDomain = '([A-Za-z0-9.\\\\-_]+)';\r\n        function gsModify(loc) {\r\n            if (loc.path.charAt(loc.path.length - 1) === '/') {\r\n                loc.path_ = loc.path_.slice(0, -1);\r\n            }\r\n        }\r\n        var gsPath = '(/(.*))?$';\r\n        var gsRegex = new RegExp('^gs://' + bucketDomain + gsPath, 'i');\r\n        var gsIndices = { bucket: 1, path: 3 };\r\n        function httpModify(loc) {\r\n            loc.path_ = decodeURIComponent(loc.path);\r\n        }\r\n        var version = 'v[A-Za-z0-9_]+';\r\n        var firebaseStorageHost = DEFAULT_HOST.replace(/[.]/g, '\\\\.');\r\n        var firebaseStoragePath = '(/([^?#]*).*)?$';\r\n        var firebaseStorageRegExp = new RegExp(\"^https?://\" + firebaseStorageHost + \"/\" + version + \"/b/\" + bucketDomain + \"/o\" + firebaseStoragePath, 'i');\r\n        var firebaseStorageIndices = { bucket: 1, path: 3 };\r\n        var cloudStorageHost = '(?:storage.googleapis.com|storage.cloud.google.com)';\r\n        var cloudStoragePath = '([^?#]*)';\r\n        var cloudStorageRegExp = new RegExp(\"^https?://\" + cloudStorageHost + \"/\" + bucketDomain + \"/\" + cloudStoragePath, 'i');\r\n        var cloudStorageIndices = { bucket: 1, path: 2 };\r\n        var groups = [\r\n            { regex: gsRegex, indices: gsIndices, postModify: gsModify },\r\n            {\r\n                regex: firebaseStorageRegExp,\r\n                indices: firebaseStorageIndices,\r\n                postModify: httpModify\r\n            },\r\n            {\r\n                regex: cloudStorageRegExp,\r\n                indices: cloudStorageIndices,\r\n                postModify: httpModify\r\n            }\r\n        ];\r\n        for (var i = 0; i < groups.length; i++) {\r\n            var group = groups[i];\r\n            var captures = group.regex.exec(url);\r\n            if (captures) {\r\n                var bucketValue = captures[group.indices.bucket];\r\n                var pathValue = captures[group.indices.path];\r\n                if (!pathValue) {\r\n                    pathValue = '';\r\n                }\r\n                location = new Location(bucketValue, pathValue);\r\n                group.postModify(location);\r\n                break;\r\n            }\r\n        }\r\n        if (location == null) {\r\n            throw invalidUrl(url);\r\n        }\r\n        return location;\r\n    };\r\n    return Location;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns the Object resulting from parsing the given JSON, or null if the\r\n * given string does not represent a JSON object.\r\n */\r\nfunction jsonObjectOrNull(s) {\r\n    var obj;\r\n    try {\r\n        obj = JSON.parse(s);\r\n    }\r\n    catch (e) {\r\n        return null;\r\n    }\r\n    if (isNonArrayObject(obj)) {\r\n        return obj;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @fileoverview Contains helper methods for manipulating paths.\r\n */\r\n/**\r\n * @return Null if the path is already at the root.\r\n */\r\nfunction parent(path) {\r\n    if (path.length === 0) {\r\n        return null;\r\n    }\r\n    var index = path.lastIndexOf('/');\r\n    if (index === -1) {\r\n        return '';\r\n    }\r\n    var newPath = path.slice(0, index);\r\n    return newPath;\r\n}\r\nfunction child(path, childPath) {\r\n    var canonicalChildPath = childPath\r\n        .split('/')\r\n        .filter(function (component) { return component.length > 0; })\r\n        .join('/');\r\n    if (path.length === 0) {\r\n        return canonicalChildPath;\r\n    }\r\n    else {\r\n        return path + '/' + canonicalChildPath;\r\n    }\r\n}\r\n/**\r\n * Returns the last component of a path.\r\n * '/foo/bar' -> 'bar'\r\n * '/foo/bar/baz/' -> 'baz/'\r\n * '/a' -> 'a'\r\n */\r\nfunction lastComponent(path) {\r\n    var index = path.lastIndexOf('/', path.length - 2);\r\n    if (index === -1) {\r\n        return path;\r\n    }\r\n    else {\r\n        return path.slice(index + 1);\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction makeUrl(urlPart) {\r\n    return \"https://\" + DEFAULT_HOST + \"/v0\" + urlPart;\r\n}\r\nfunction makeQueryString(params) {\r\n    var encode = encodeURIComponent;\r\n    var queryPart = '?';\r\n    for (var key in params) {\r\n        if (params.hasOwnProperty(key)) {\r\n            // @ts-ignore TODO: remove once typescript is upgraded to 3.5.x\r\n            var nextPart = encode(key) + '=' + encode(params[key]);\r\n            queryPart = queryPart + nextPart + '&';\r\n        }\r\n    }\r\n    // Chop off the extra '&' or '?' on the end\r\n    queryPart = queryPart.slice(0, -1);\r\n    return queryPart;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction noXform_(metadata, value) {\r\n    return value;\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar Mapping = /** @class */ (function () {\r\n    function Mapping(server, local, writable, xform) {\r\n        this.server = server;\r\n        this.local = local || server;\r\n        this.writable = !!writable;\r\n        this.xform = xform || noXform_;\r\n    }\r\n    return Mapping;\r\n}());\r\nvar mappings_ = null;\r\nfunction xformPath(fullPath) {\r\n    if (!isString(fullPath) || fullPath.length < 2) {\r\n        return fullPath;\r\n    }\r\n    else {\r\n        return lastComponent(fullPath);\r\n    }\r\n}\r\nfunction getMappings() {\r\n    if (mappings_) {\r\n        return mappings_;\r\n    }\r\n    var mappings = [];\r\n    mappings.push(new Mapping('bucket'));\r\n    mappings.push(new Mapping('generation'));\r\n    mappings.push(new Mapping('metageneration'));\r\n    mappings.push(new Mapping('name', 'fullPath', true));\r\n    function mappingsXformPath(_metadata, fullPath) {\r\n        return xformPath(fullPath);\r\n    }\r\n    var nameMapping = new Mapping('name');\r\n    nameMapping.xform = mappingsXformPath;\r\n    mappings.push(nameMapping);\r\n    /**\r\n     * Coerces the second param to a number, if it is defined.\r\n     */\r\n    function xformSize(_metadata, size) {\r\n        if (isDef(size)) {\r\n            return Number(size);\r\n        }\r\n        else {\r\n            return size;\r\n        }\r\n    }\r\n    var sizeMapping = new Mapping('size');\r\n    sizeMapping.xform = xformSize;\r\n    mappings.push(sizeMapping);\r\n    mappings.push(new Mapping('timeCreated'));\r\n    mappings.push(new Mapping('updated'));\r\n    mappings.push(new Mapping('md5Hash', null, true));\r\n    mappings.push(new Mapping('cacheControl', null, true));\r\n    mappings.push(new Mapping('contentDisposition', null, true));\r\n    mappings.push(new Mapping('contentEncoding', null, true));\r\n    mappings.push(new Mapping('contentLanguage', null, true));\r\n    mappings.push(new Mapping('contentType', null, true));\r\n    mappings.push(new Mapping('metadata', 'customMetadata', true));\r\n    mappings_ = mappings;\r\n    return mappings_;\r\n}\r\nfunction addRef(metadata, service) {\r\n    function generateRef() {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var loc = new Location(bucket, path);\r\n        return service.makeStorageReference(loc);\r\n    }\r\n    Object.defineProperty(metadata, 'ref', { get: generateRef });\r\n}\r\nfunction fromResource(service, resource, mappings) {\r\n    var metadata = {};\r\n    metadata['type'] = 'file';\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        metadata[mapping.local] = mapping.xform(metadata, resource[mapping.server]);\r\n    }\r\n    addRef(metadata, service);\r\n    return metadata;\r\n}\r\nfunction fromResourceString(service, resourceString, mappings) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromResource(service, resource, mappings);\r\n}\r\nfunction downloadUrlFromResourceString(metadata, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    if (!isString(obj['downloadTokens'])) {\r\n        // This can happen if objects are uploaded through GCS and retrieved\r\n        // through list, so we don't want to throw an Error.\r\n        return null;\r\n    }\r\n    var tokens = obj['downloadTokens'];\r\n    if (tokens.length === 0) {\r\n        return null;\r\n    }\r\n    var encode = encodeURIComponent;\r\n    var tokensList = tokens.split(',');\r\n    var urls = tokensList.map(function (token) {\r\n        var bucket = metadata['bucket'];\r\n        var path = metadata['fullPath'];\r\n        var urlPart = '/b/' + encode(bucket) + '/o/' + encode(path);\r\n        var base = makeUrl(urlPart);\r\n        var queryString = makeQueryString({\r\n            alt: 'media',\r\n            token: token\r\n        });\r\n        return base + queryString;\r\n    });\r\n    return urls[0];\r\n}\r\nfunction toResourceString(metadata, mappings) {\r\n    var resource = {};\r\n    var len = mappings.length;\r\n    for (var i = 0; i < len; i++) {\r\n        var mapping = mappings[i];\r\n        if (mapping.writable) {\r\n            resource[mapping.server] = metadata[mapping.local];\r\n        }\r\n    }\r\n    return JSON.stringify(resource);\r\n}\r\nfunction metadataValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected Metadata object.';\r\n    }\r\n    for (var key in p) {\r\n        if (p.hasOwnProperty(key)) {\r\n            var val = p[key];\r\n            if (key === 'customMetadata') {\r\n                if (!isObject(val)) {\r\n                    throw 'Expected object for \\'customMetadata\\' mapping.';\r\n                }\r\n            }\r\n            else {\r\n                if (isNonNullObject(val)) {\r\n                    throw \"Mapping for '\" + key + \"' cannot be an object.\";\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MAX_RESULTS_KEY = 'maxResults';\r\nvar MAX_MAX_RESULTS = 1000;\r\nvar PAGE_TOKEN_KEY = 'pageToken';\r\nvar PREFIXES_KEY = 'prefixes';\r\nvar ITEMS_KEY = 'items';\r\nfunction fromBackendResponse(service, bucket, resource) {\r\n    var listResult = {\r\n        prefixes: [],\r\n        items: [],\r\n        nextPageToken: resource['nextPageToken']\r\n    };\r\n    if (resource[PREFIXES_KEY]) {\r\n        for (var _i = 0, _a = resource[PREFIXES_KEY]; _i < _a.length; _i++) {\r\n            var path = _a[_i];\r\n            var pathWithoutTrailingSlash = path.replace(/\\/$/, '');\r\n            var reference = service.makeStorageReference(new Location(bucket, pathWithoutTrailingSlash));\r\n            listResult.prefixes.push(reference);\r\n        }\r\n    }\r\n    if (resource[ITEMS_KEY]) {\r\n        for (var _b = 0, _c = resource[ITEMS_KEY]; _b < _c.length; _b++) {\r\n            var item = _c[_b];\r\n            var reference = service.makeStorageReference(new Location(bucket, item['name']));\r\n            listResult.items.push(reference);\r\n        }\r\n    }\r\n    return listResult;\r\n}\r\nfunction fromResponseString(service, bucket, resourceString) {\r\n    var obj = jsonObjectOrNull(resourceString);\r\n    if (obj === null) {\r\n        return null;\r\n    }\r\n    var resource = obj;\r\n    return fromBackendResponse(service, bucket, resource);\r\n}\r\nfunction listOptionsValidator(p) {\r\n    if (!isObject(p) || !p) {\r\n        throw 'Expected ListOptions object.';\r\n    }\r\n    for (var key in p) {\r\n        if (key === MAX_RESULTS_KEY) {\r\n            if (!isInteger(p[MAX_RESULTS_KEY]) ||\r\n                p[MAX_RESULTS_KEY] <= 0) {\r\n                throw 'Expected maxResults to be a positive number.';\r\n            }\r\n            if (p[MAX_RESULTS_KEY] > 1000) {\r\n                throw \"Expected maxResults to be less than or equal to \" + MAX_MAX_RESULTS + \".\";\r\n            }\r\n        }\r\n        else if (key === PAGE_TOKEN_KEY) {\r\n            if (p[PAGE_TOKEN_KEY] && !isString(p[PAGE_TOKEN_KEY])) {\r\n                throw 'Expected pageToken to be string.';\r\n            }\r\n        }\r\n        else {\r\n            throw 'Unknown option: ' + key;\r\n        }\r\n    }\r\n}\n\nvar RequestInfo = /** @class */ (function () {\r\n    function RequestInfo(url, method, \r\n    /**\r\n     * Returns the value with which to resolve the request's promise. Only called\r\n     * if the request is successful. Throw from this function to reject the\r\n     * returned Request's promise with the thrown error.\r\n     * Note: The XhrIo passed to this function may be reused after this callback\r\n     * returns. Do not keep a reference to it in any way.\r\n     */\r\n    handler, timeout) {\r\n        this.url = url;\r\n        this.method = method;\r\n        this.handler = handler;\r\n        this.timeout = timeout;\r\n        this.urlParams = {};\r\n        this.headers = {};\r\n        this.body = null;\r\n        this.errorHandler = null;\r\n        /**\r\n         * Called with the current number of bytes uploaded and total size (-1 if not\r\n         * computable) of the request body (i.e. used to report upload progress).\r\n         */\r\n        this.progressCallback = null;\r\n        this.successCodes = [200];\r\n        this.additionalRetryCodes = [];\r\n    }\r\n    return RequestInfo;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Throws the UNKNOWN FirebaseStorageError if cndn is false.\r\n */\r\nfunction handlerCheck(cndn) {\r\n    if (!cndn) {\r\n        throw unknown();\r\n    }\r\n}\r\nfunction metadataHandler(service, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(service, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return metadata;\r\n    }\r\n    return handler;\r\n}\r\nfunction listHandler(service, bucket) {\r\n    function handler(xhr, text) {\r\n        var listResult = fromResponseString(service, bucket, text);\r\n        handlerCheck(listResult !== null);\r\n        return listResult;\r\n    }\r\n    return handler;\r\n}\r\nfunction downloadUrlHandler(service, mappings) {\r\n    function handler(xhr, text) {\r\n        var metadata = fromResourceString(service, text, mappings);\r\n        handlerCheck(metadata !== null);\r\n        return downloadUrlFromResourceString(metadata, text);\r\n    }\r\n    return handler;\r\n}\r\nfunction sharedErrorHandler(location) {\r\n    function errorHandler(xhr, err) {\r\n        var newErr;\r\n        if (xhr.getStatus() === 401) {\r\n            newErr = unauthenticated();\r\n        }\r\n        else {\r\n            if (xhr.getStatus() === 402) {\r\n                newErr = quotaExceeded(location.bucket);\r\n            }\r\n            else {\r\n                if (xhr.getStatus() === 403) {\r\n                    newErr = unauthorized(location.path);\r\n                }\r\n                else {\r\n                    newErr = err;\r\n                }\r\n            }\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction objectErrorHandler(location) {\r\n    var shared = sharedErrorHandler(location);\r\n    function errorHandler(xhr, err) {\r\n        var newErr = shared(xhr, err);\r\n        if (xhr.getStatus() === 404) {\r\n            newErr = objectNotFound(location.path);\r\n        }\r\n        newErr.setServerResponseProp(err.serverResponseProp());\r\n        return newErr;\r\n    }\r\n    return errorHandler;\r\n}\r\nfunction getMetadata(service, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction list(service, location, delimiter, pageToken, maxResults) {\r\n    var urlParams = {};\r\n    if (location.isRoot) {\r\n        urlParams['prefix'] = '';\r\n    }\r\n    else {\r\n        urlParams['prefix'] = location.path + '/';\r\n    }\r\n    if (delimiter && delimiter.length > 0) {\r\n        urlParams['delimiter'] = delimiter;\r\n    }\r\n    if (pageToken) {\r\n        urlParams['pageToken'] = pageToken;\r\n    }\r\n    if (maxResults) {\r\n        urlParams['maxResults'] = maxResults;\r\n    }\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, listHandler(service, location.bucket), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction getDownloadUrl(service, location, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'GET';\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, downloadUrlHandler(service, mappings), timeout);\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction updateMetadata(service, location, metadata, mappings) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'PATCH';\r\n    var body = toResourceString(metadata, mappings);\r\n    var headers = { 'Content-Type': 'application/json; charset=utf-8' };\r\n    var timeout = service.maxOperationRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction deleteObject(service, location) {\r\n    var urlPart = location.fullServerUrl();\r\n    var url = makeUrl(urlPart);\r\n    var method = 'DELETE';\r\n    var timeout = service.maxOperationRetryTime;\r\n    function handler(_xhr, _text) { }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.successCodes = [200, 204];\r\n    requestInfo.errorHandler = objectErrorHandler(location);\r\n    return requestInfo;\r\n}\r\nfunction determineContentType_(metadata, blob) {\r\n    return ((metadata && metadata['contentType']) ||\r\n        (blob && blob.type()) ||\r\n        'application/octet-stream');\r\n}\r\nfunction metadataForUpload_(location, blob, metadata) {\r\n    var metadataClone = Object.assign({}, metadata);\r\n    metadataClone['fullPath'] = location.path;\r\n    metadataClone['size'] = blob.size();\r\n    if (!metadataClone['contentType']) {\r\n        metadataClone['contentType'] = determineContentType_(null, blob);\r\n    }\r\n    return metadataClone;\r\n}\r\nfunction multipartUpload(service, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'multipart'\r\n    };\r\n    function genBoundary() {\r\n        var str = '';\r\n        for (var i = 0; i < 2; i++) {\r\n            str = str + Math.random().toString().slice(2);\r\n        }\r\n        return str;\r\n    }\r\n    var boundary = genBoundary();\r\n    headers['Content-Type'] = 'multipart/related; boundary=' + boundary;\r\n    var metadata_ = metadataForUpload_(location, blob, metadata);\r\n    var metadataString = toResourceString(metadata_, mappings);\r\n    var preBlobPart = '--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: application/json; charset=utf-8\\r\\n\\r\\n' +\r\n        metadataString +\r\n        '\\r\\n--' +\r\n        boundary +\r\n        '\\r\\n' +\r\n        'Content-Type: ' +\r\n        metadata_['contentType'] +\r\n        '\\r\\n\\r\\n';\r\n    var postBlobPart = '\\r\\n--' + boundary + '--';\r\n    var body = FbsBlob.getBlob(preBlobPart, blob, postBlobPart);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    var urlParams = { name: metadata_['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, metadataHandler(service, mappings), timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param current The number of bytes that have been uploaded so far.\r\n * @param total The total number of bytes in the upload.\r\n * @param opt_finalized True if the server has finished the upload.\r\n * @param opt_metadata The upload metadata, should\r\n *     only be passed if opt_finalized is true.\r\n * @struct\r\n */\r\nvar ResumableUploadStatus = /** @class */ (function () {\r\n    function ResumableUploadStatus(current, total, finalized, metadata) {\r\n        this.current = current;\r\n        this.total = total;\r\n        this.finalized = !!finalized;\r\n        this.metadata = metadata || null;\r\n    }\r\n    return ResumableUploadStatus;\r\n}());\r\nfunction checkResumeHeader_(xhr, allowed) {\r\n    var status = null;\r\n    try {\r\n        status = xhr.getResponseHeader('X-Goog-Upload-Status');\r\n    }\r\n    catch (e) {\r\n        handlerCheck(false);\r\n    }\r\n    var allowedStatus = allowed || ['active'];\r\n    handlerCheck(!!status && allowedStatus.indexOf(status) !== -1);\r\n    return status;\r\n}\r\nfunction createResumableUpload(service, location, mappings, blob, metadata) {\r\n    var urlPart = location.bucketOnlyServerUrl();\r\n    var metadataForUpload = metadataForUpload_(location, blob, metadata);\r\n    var urlParams = { name: metadataForUpload['fullPath'] };\r\n    var url = makeUrl(urlPart);\r\n    var method = 'POST';\r\n    var headers = {\r\n        'X-Goog-Upload-Protocol': 'resumable',\r\n        'X-Goog-Upload-Command': 'start',\r\n        'X-Goog-Upload-Header-Content-Length': blob.size(),\r\n        'X-Goog-Upload-Header-Content-Type': metadataForUpload['contentType'],\r\n        'Content-Type': 'application/json; charset=utf-8'\r\n    };\r\n    var body = toResourceString(metadataForUpload, mappings);\r\n    var timeout = service.maxUploadRetryTime;\r\n    function handler(xhr) {\r\n        checkResumeHeader_(xhr);\r\n        var url;\r\n        try {\r\n            url = xhr.getResponseHeader('X-Goog-Upload-URL');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        handlerCheck(isString(url));\r\n        return url;\r\n    }\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.urlParams = urlParams;\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n */\r\nfunction getResumableUploadStatus(service, location, url, blob) {\r\n    var headers = { 'X-Goog-Upload-Command': 'query' };\r\n    function handler(xhr) {\r\n        var status = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var sizeString = null;\r\n        try {\r\n            sizeString = xhr.getResponseHeader('X-Goog-Upload-Size-Received');\r\n        }\r\n        catch (e) {\r\n            handlerCheck(false);\r\n        }\r\n        if (!sizeString) {\r\n            // null or empty string\r\n            handlerCheck(false);\r\n        }\r\n        var size = Number(sizeString);\r\n        handlerCheck(!isNaN(size));\r\n        return new ResumableUploadStatus(size, blob.size(), status === 'final');\r\n    }\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\r\n/**\r\n * Any uploads via the resumable upload API must transfer a number of bytes\r\n * that is a multiple of this number.\r\n */\r\nvar resumableUploadChunkSize = 256 * 1024;\r\n/**\r\n * @param url From a call to fbs.requests.createResumableUpload.\r\n * @param chunkSize Number of bytes to upload.\r\n * @param status The previous status.\r\n *     If not passed or null, we start from the beginning.\r\n * @throws fbs.Error If the upload is already complete, the passed in status\r\n *     has a final size inconsistent with the blob, or the blob cannot be sliced\r\n *     for upload.\r\n */\r\nfunction continueResumableUpload(location, service, url, blob, chunkSize, mappings, status, progressCallback) {\r\n    // TODO(andysoto): standardize on internal asserts\r\n    // assert(!(opt_status && opt_status.finalized));\r\n    var status_ = new ResumableUploadStatus(0, 0);\r\n    if (status) {\r\n        status_.current = status.current;\r\n        status_.total = status.total;\r\n    }\r\n    else {\r\n        status_.current = 0;\r\n        status_.total = blob.size();\r\n    }\r\n    if (blob.size() !== status_.total) {\r\n        throw serverFileWrongSize();\r\n    }\r\n    var bytesLeft = status_.total - status_.current;\r\n    var bytesToUpload = bytesLeft;\r\n    if (chunkSize > 0) {\r\n        bytesToUpload = Math.min(bytesToUpload, chunkSize);\r\n    }\r\n    var startByte = status_.current;\r\n    var endByte = startByte + bytesToUpload;\r\n    var uploadCommand = bytesToUpload === bytesLeft ? 'upload, finalize' : 'upload';\r\n    var headers = {\r\n        'X-Goog-Upload-Command': uploadCommand,\r\n        'X-Goog-Upload-Offset': status_.current\r\n    };\r\n    var body = blob.slice(startByte, endByte);\r\n    if (body === null) {\r\n        throw cannotSliceBlob();\r\n    }\r\n    function handler(xhr, text) {\r\n        // TODO(andysoto): Verify the MD5 of each uploaded range:\r\n        // the 'x-range-md5' header comes back with status code 308 responses.\r\n        // We'll only be able to bail out though, because you can't re-upload a\r\n        // range that you previously uploaded.\r\n        var uploadStatus = checkResumeHeader_(xhr, ['active', 'final']);\r\n        var newCurrent = status_.current + bytesToUpload;\r\n        var size = blob.size();\r\n        var metadata;\r\n        if (uploadStatus === 'final') {\r\n            metadata = metadataHandler(service, mappings)(xhr, text);\r\n        }\r\n        else {\r\n            metadata = null;\r\n        }\r\n        return new ResumableUploadStatus(newCurrent, size, uploadStatus === 'final', metadata);\r\n    }\r\n    var method = 'POST';\r\n    var timeout = service.maxUploadRetryTime;\r\n    var requestInfo = new RequestInfo(url, method, handler, timeout);\r\n    requestInfo.headers = headers;\r\n    requestInfo.body = body.uploadData();\r\n    requestInfo.progressCallback = progressCallback || null;\r\n    requestInfo.errorHandler = sharedErrorHandler(location);\r\n    return requestInfo;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n */\r\nvar Observer = /** @class */ (function () {\r\n    function Observer(nextOrObserver, error, complete) {\r\n        var asFunctions = isFunction(nextOrObserver) ||\r\n            isDef(error) ||\r\n            isDef(complete);\r\n        if (asFunctions) {\r\n            this.next = nextOrObserver;\r\n            this.error = error || null;\r\n            this.complete = complete || null;\r\n        }\r\n        else {\r\n            var observer = nextOrObserver;\r\n            this.next = observer.next || null;\r\n            this.error = observer.error || null;\r\n            this.complete = observer.complete || null;\r\n        }\r\n    }\r\n    return Observer;\r\n}());\n\nvar UploadTaskSnapshot = /** @class */ (function () {\r\n    function UploadTaskSnapshot(bytesTransferred, totalBytes, state, metadata, task, ref) {\r\n        this.bytesTransferred = bytesTransferred;\r\n        this.totalBytes = totalBytes;\r\n        this.state = state;\r\n        this.metadata = metadata;\r\n        this.task = task;\r\n        this.ref = ref;\r\n    }\r\n    return UploadTaskSnapshot;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param name Name of the function.\r\n * @param specs Argument specs.\r\n * @param passed The actual arguments passed to the function.\r\n * @throws {fbs.Error} If the arguments are invalid.\r\n */\r\nfunction validate(name, specs, passed) {\r\n    var minArgs = specs.length;\r\n    var maxArgs = specs.length;\r\n    for (var i = 0; i < specs.length; i++) {\r\n        if (specs[i].optional) {\r\n            minArgs = i;\r\n            break;\r\n        }\r\n    }\r\n    var validLength = minArgs <= passed.length && passed.length <= maxArgs;\r\n    if (!validLength) {\r\n        throw invalidArgumentCount(minArgs, maxArgs, name, passed.length);\r\n    }\r\n    for (var i = 0; i < passed.length; i++) {\r\n        try {\r\n            specs[i].validator(passed[i]);\r\n        }\r\n        catch (e) {\r\n            if (e instanceof Error) {\r\n                throw invalidArgument(i, name, e.message);\r\n            }\r\n            else {\r\n                throw invalidArgument(i, name, e);\r\n            }\r\n        }\r\n    }\r\n}\r\n/**\r\n * @struct\r\n */\r\nvar ArgSpec = /** @class */ (function () {\r\n    function ArgSpec(validator, optional) {\r\n        var self = this;\r\n        this.validator = function (p) {\r\n            if (self.optional && !isJustDef(p)) {\r\n                return;\r\n            }\r\n            validator(p);\r\n        };\r\n        this.optional = !!optional;\r\n    }\r\n    return ArgSpec;\r\n}());\r\nfunction and_(v1, v2) {\r\n    return function (p) {\r\n        v1(p);\r\n        v2(p);\r\n    };\r\n}\r\nfunction stringSpec(validator, optional) {\r\n    function stringValidator(p) {\r\n        if (!isString(p)) {\r\n            throw 'Expected string.';\r\n        }\r\n    }\r\n    var chainedValidator;\r\n    if (validator) {\r\n        chainedValidator = and_(stringValidator, validator);\r\n    }\r\n    else {\r\n        chainedValidator = stringValidator;\r\n    }\r\n    return new ArgSpec(chainedValidator, optional);\r\n}\r\nfunction uploadDataSpec() {\r\n    function validator(p) {\r\n        var valid = p instanceof Uint8Array ||\r\n            p instanceof ArrayBuffer ||\r\n            (isNativeBlobDefined() && p instanceof Blob);\r\n        if (!valid) {\r\n            throw 'Expected Blob or File.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction metadataSpec(optional) {\r\n    return new ArgSpec(metadataValidator, optional);\r\n}\r\nfunction listOptionSpec(optional) {\r\n    return new ArgSpec(listOptionsValidator, optional);\r\n}\r\nfunction nonNegativeNumberSpec() {\r\n    function validator(p) {\r\n        var valid = isNumber(p) && p >= 0;\r\n        if (!valid) {\r\n            throw 'Expected a number 0 or greater.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator);\r\n}\r\nfunction looseObjectSpec(validator, optional) {\r\n    function isLooseObjectValidator(p) {\r\n        var isLooseObject = p === null || (isDef(p) && p instanceof Object);\r\n        if (!isLooseObject) {\r\n            throw 'Expected an Object.';\r\n        }\r\n        if (validator !== undefined && validator !== null) {\r\n            validator(p);\r\n        }\r\n    }\r\n    return new ArgSpec(isLooseObjectValidator, optional);\r\n}\r\nfunction nullFunctionSpec(optional) {\r\n    function validator(p) {\r\n        var valid = p === null || isFunction(p);\r\n        if (!valid) {\r\n            throw 'Expected a Function.';\r\n        }\r\n    }\r\n    return new ArgSpec(validator, optional);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a function that invokes f with its arguments asynchronously as a\r\n * microtask, i.e. as soon as possible after the current script returns back\r\n * into browser code.\r\n */\r\n// eslint-disable-next-line @typescript-eslint/ban-types\r\nfunction async(f) {\r\n    return function () {\r\n        var argsToForward = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            argsToForward[_i] = arguments[_i];\r\n        }\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        Promise.resolve().then(function () { return f.apply(void 0, argsToForward); });\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Represents a blob being uploaded. Can be used to pause/resume/cancel the\r\n * upload and manage callbacks for various events.\r\n */\r\nvar UploadTask = /** @class */ (function () {\r\n    /**\r\n     * @param ref The firebaseStorage.Reference object this task came\r\n     *     from, untyped to avoid cyclic dependencies.\r\n     * @param blob The blob to upload.\r\n     */\r\n    function UploadTask(ref, service, location, mappings, blob, metadata) {\r\n        var _this = this;\r\n        if (metadata === void 0) { metadata = null; }\r\n        this.transferred_ = 0;\r\n        this.needToFetchStatus_ = false;\r\n        this.needToFetchMetadata_ = false;\r\n        this.observers_ = [];\r\n        this.error_ = null;\r\n        this.uploadUrl_ = null;\r\n        this.request_ = null;\r\n        this.chunkMultiplier_ = 1;\r\n        this.resolve_ = null;\r\n        this.reject_ = null;\r\n        this.ref_ = ref;\r\n        this.service_ = service;\r\n        this.location_ = location;\r\n        this.blob_ = blob;\r\n        this.metadata_ = metadata;\r\n        this.mappings_ = mappings;\r\n        this.resumable_ = this.shouldDoResumable_(this.blob_);\r\n        this.state_ = InternalTaskState.RUNNING;\r\n        this.errorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            _this.chunkMultiplier_ = 1;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.needToFetchStatus_ = true;\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.metadataErrorHandler_ = function (error) {\r\n            _this.request_ = null;\r\n            if (error.codeEquals(Code.CANCELED)) {\r\n                _this.completeTransitions_();\r\n            }\r\n            else {\r\n                _this.error_ = error;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n            }\r\n        };\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n        // Prevent uncaught rejections on the internal promise from bubbling out\r\n        // to the top level with a dummy handler.\r\n        this.promise_.then(null, function () { });\r\n    }\r\n    UploadTask.prototype.makeProgressCallback_ = function () {\r\n        var _this = this;\r\n        var sizeBefore = this.transferred_;\r\n        return function (loaded) { return _this.updateProgress_(sizeBefore + loaded); };\r\n    };\r\n    UploadTask.prototype.shouldDoResumable_ = function (blob) {\r\n        return blob.size() > 256 * 1024;\r\n    };\r\n    UploadTask.prototype.start_ = function () {\r\n        if (this.state_ !== InternalTaskState.RUNNING) {\r\n            // This can happen if someone pauses us in a resume callback, for example.\r\n            return;\r\n        }\r\n        if (this.request_ !== null) {\r\n            return;\r\n        }\r\n        if (this.resumable_) {\r\n            if (this.uploadUrl_ === null) {\r\n                this.createResumable_();\r\n            }\r\n            else {\r\n                if (this.needToFetchStatus_) {\r\n                    this.fetchStatus_();\r\n                }\r\n                else {\r\n                    if (this.needToFetchMetadata_) {\r\n                        // Happens if we miss the metadata on upload completion.\r\n                        this.fetchMetadata_();\r\n                    }\r\n                    else {\r\n                        this.continueUpload_();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.oneShotUpload_();\r\n        }\r\n    };\r\n    UploadTask.prototype.resolveToken_ = function (callback) {\r\n        var _this = this;\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this.service_.getAuthToken().then(function (authToken) {\r\n            switch (_this.state_) {\r\n                case InternalTaskState.RUNNING:\r\n                    callback(authToken);\r\n                    break;\r\n                case InternalTaskState.CANCELING:\r\n                    _this.transition_(InternalTaskState.CANCELED);\r\n                    break;\r\n                case InternalTaskState.PAUSING:\r\n                    _this.transition_(InternalTaskState.PAUSED);\r\n                    break;\r\n            }\r\n        });\r\n    };\r\n    // TODO(andysoto): assert false\r\n    UploadTask.prototype.createResumable_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = createResumableUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var createRequest = _this.service_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = createRequest;\r\n            createRequest.getPromise().then(function (url) {\r\n                _this.request_ = null;\r\n                _this.uploadUrl_ = url;\r\n                _this.needToFetchStatus_ = false;\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.fetchStatus_ = function () {\r\n        var _this = this;\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getResumableUploadStatus(_this.service_, _this.location_, url, _this.blob_);\r\n            var statusRequest = _this.service_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = statusRequest;\r\n            statusRequest.getPromise().then(function (status) {\r\n                status = status;\r\n                _this.request_ = null;\r\n                _this.updateProgress_(status.current);\r\n                _this.needToFetchStatus_ = false;\r\n                if (status.finalized) {\r\n                    _this.needToFetchMetadata_ = true;\r\n                }\r\n                _this.completeTransitions_();\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.continueUpload_ = function () {\r\n        var _this = this;\r\n        var chunkSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        var status = new ResumableUploadStatus(this.transferred_, this.blob_.size());\r\n        // TODO(andysoto): assert(this.uploadUrl_ !== null);\r\n        var url = this.uploadUrl_;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo;\r\n            try {\r\n                requestInfo = continueResumableUpload(_this.location_, _this.service_, url, _this.blob_, chunkSize, _this.mappings_, status, _this.makeProgressCallback_());\r\n            }\r\n            catch (e) {\r\n                _this.error_ = e;\r\n                _this.transition_(InternalTaskState.ERROR);\r\n                return;\r\n            }\r\n            var uploadRequest = _this.service_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = uploadRequest;\r\n            uploadRequest\r\n                .getPromise()\r\n                .then(function (newStatus) {\r\n                _this.increaseMultiplier_();\r\n                _this.request_ = null;\r\n                _this.updateProgress_(newStatus.current);\r\n                if (newStatus.finalized) {\r\n                    _this.metadata_ = newStatus.metadata;\r\n                    _this.transition_(InternalTaskState.SUCCESS);\r\n                }\r\n                else {\r\n                    _this.completeTransitions_();\r\n                }\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.increaseMultiplier_ = function () {\r\n        var currentSize = resumableUploadChunkSize * this.chunkMultiplier_;\r\n        // Max chunk size is 32M.\r\n        if (currentSize < 32 * 1024 * 1024) {\r\n            this.chunkMultiplier_ *= 2;\r\n        }\r\n    };\r\n    UploadTask.prototype.fetchMetadata_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = getMetadata(_this.service_, _this.location_, _this.mappings_);\r\n            var metadataRequest = _this.service_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = metadataRequest;\r\n            metadataRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.metadataErrorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.oneShotUpload_ = function () {\r\n        var _this = this;\r\n        this.resolveToken_(function (authToken) {\r\n            var requestInfo = multipartUpload(_this.service_, _this.location_, _this.mappings_, _this.blob_, _this.metadata_);\r\n            var multipartRequest = _this.service_.makeRequest(requestInfo, authToken);\r\n            _this.request_ = multipartRequest;\r\n            multipartRequest.getPromise().then(function (metadata) {\r\n                _this.request_ = null;\r\n                _this.metadata_ = metadata;\r\n                _this.updateProgress_(_this.blob_.size());\r\n                _this.transition_(InternalTaskState.SUCCESS);\r\n            }, _this.errorHandler_);\r\n        });\r\n    };\r\n    UploadTask.prototype.updateProgress_ = function (transferred) {\r\n        var old = this.transferred_;\r\n        this.transferred_ = transferred;\r\n        // A progress update can make the \"transferred\" value smaller (e.g. a\r\n        // partial upload not completed by server, after which the \"transferred\"\r\n        // value may reset to the value at the beginning of the request).\r\n        if (this.transferred_ !== old) {\r\n            this.notifyObservers_();\r\n        }\r\n    };\r\n    UploadTask.prototype.transition_ = function (state) {\r\n        if (this.state_ === state) {\r\n            return;\r\n        }\r\n        switch (state) {\r\n            case InternalTaskState.CANCELING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING);\r\n                this.state_ = state;\r\n                if (this.request_ !== null) {\r\n                    this.request_.cancel();\r\n                }\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.PAUSING);\r\n                var wasPaused = this.state_ === InternalTaskState.PAUSED;\r\n                this.state_ = state;\r\n                if (wasPaused) {\r\n                    this.notifyObservers_();\r\n                    this.start_();\r\n                }\r\n                break;\r\n            case InternalTaskState.PAUSED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.CANCELED:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.PAUSED ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.error_ = canceled();\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.ERROR:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n            case InternalTaskState.SUCCESS:\r\n                // TODO(andysoto):\r\n                // assert(this.state_ === InternalTaskState.RUNNING ||\r\n                //        this.state_ === InternalTaskState.PAUSING ||\r\n                //        this.state_ === InternalTaskState.CANCELING);\r\n                this.state_ = state;\r\n                this.notifyObservers_();\r\n                break;\r\n        }\r\n    };\r\n    UploadTask.prototype.completeTransitions_ = function () {\r\n        switch (this.state_) {\r\n            case InternalTaskState.PAUSING:\r\n                this.transition_(InternalTaskState.PAUSED);\r\n                break;\r\n            case InternalTaskState.CANCELING:\r\n                this.transition_(InternalTaskState.CANCELED);\r\n                break;\r\n            case InternalTaskState.RUNNING:\r\n                this.start_();\r\n                break;\r\n        }\r\n    };\r\n    Object.defineProperty(UploadTask.prototype, \"snapshot\", {\r\n        get: function () {\r\n            var externalState = taskStateFromInternalTaskState(this.state_);\r\n            return new UploadTaskSnapshot(this.transferred_, this.blob_.size(), externalState, this.metadata_, this, this.ref_);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Adds a callback for an event.\r\n     * @param type The type of event to listen for.\r\n     */\r\n    UploadTask.prototype.on = function (type, nextOrObserver, error, completed) {\r\n        function typeValidator() {\r\n            if (type !== TaskEvent.STATE_CHANGED) {\r\n                throw \"Expected one of the event types: [\" + TaskEvent.STATE_CHANGED + \"].\";\r\n            }\r\n        }\r\n        var nextOrObserverMessage = 'Expected a function or an Object with one of ' +\r\n            '`next`, `error`, `complete` properties.';\r\n        var nextValidator = nullFunctionSpec(true).validator;\r\n        var observerValidator = looseObjectSpec(null, true).validator;\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        function nextOrObserverValidator(p) {\r\n            try {\r\n                nextValidator(p);\r\n                return;\r\n            }\r\n            catch (e) { }\r\n            try {\r\n                observerValidator(p);\r\n                var anyDefined = isJustDef(p['next']) ||\r\n                    isJustDef(p['error']) ||\r\n                    isJustDef(p['complete']);\r\n                if (!anyDefined) {\r\n                    throw '';\r\n                }\r\n                return;\r\n            }\r\n            catch (e) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n        }\r\n        var specs = [\r\n            stringSpec(typeValidator),\r\n            looseObjectSpec(nextOrObserverValidator, true),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        validate('on', specs, arguments);\r\n        var self = this;\r\n        function makeBinder(specs) {\r\n            function binder(nextOrObserver, error, complete) {\r\n                if (specs !== null) {\r\n                    validate('on', specs, arguments);\r\n                }\r\n                var observer = new Observer(nextOrObserver, error, completed);\r\n                self.addObserver_(observer);\r\n                return function () {\r\n                    self.removeObserver_(observer);\r\n                };\r\n            }\r\n            return binder;\r\n        }\r\n        function binderNextOrObserverValidator(p) {\r\n            if (p === null) {\r\n                throw nextOrObserverMessage;\r\n            }\r\n            nextOrObserverValidator(p);\r\n        }\r\n        var binderSpecs = [\r\n            looseObjectSpec(binderNextOrObserverValidator),\r\n            nullFunctionSpec(true),\r\n            nullFunctionSpec(true)\r\n        ];\r\n        var typeOnly = !(isJustDef(nextOrObserver) ||\r\n            isJustDef(error) ||\r\n            isJustDef(completed));\r\n        if (typeOnly) {\r\n            return makeBinder(binderSpecs);\r\n        }\r\n        else {\r\n            return makeBinder(null)(nextOrObserver, error, completed);\r\n        }\r\n    };\r\n    /**\r\n     * This object behaves like a Promise, and resolves with its snapshot data\r\n     * when the upload completes.\r\n     * @param onFulfilled The fulfillment callback. Promise chaining works as normal.\r\n     * @param onRejected The rejection callback.\r\n     */\r\n    UploadTask.prototype.then = function (onFulfilled, onRejected) {\r\n        // These casts are needed so that TypeScript can infer the types of the\r\n        // resulting Promise.\r\n        return this.promise_.then(onFulfilled, onRejected);\r\n    };\r\n    /**\r\n     * Equivalent to calling `then(null, onRejected)`.\r\n     */\r\n    UploadTask.prototype.catch = function (onRejected) {\r\n        return this.then(null, onRejected);\r\n    };\r\n    /**\r\n     * Adds the given observer.\r\n     */\r\n    UploadTask.prototype.addObserver_ = function (observer) {\r\n        this.observers_.push(observer);\r\n        this.notifyObserver_(observer);\r\n    };\r\n    /**\r\n     * Removes the given observer.\r\n     */\r\n    UploadTask.prototype.removeObserver_ = function (observer) {\r\n        var i = this.observers_.indexOf(observer);\r\n        if (i !== -1) {\r\n            this.observers_.splice(i, 1);\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObservers_ = function () {\r\n        var _this = this;\r\n        this.finishPromise_();\r\n        var observers = this.observers_.slice();\r\n        observers.forEach(function (observer) {\r\n            _this.notifyObserver_(observer);\r\n        });\r\n    };\r\n    UploadTask.prototype.finishPromise_ = function () {\r\n        if (this.resolve_ !== null) {\r\n            var triggered = true;\r\n            switch (taskStateFromInternalTaskState(this.state_)) {\r\n                case TaskState.SUCCESS:\r\n                    async(this.resolve_.bind(null, this.snapshot))();\r\n                    break;\r\n                case TaskState.CANCELED:\r\n                case TaskState.ERROR:\r\n                    var toCall = this.reject_;\r\n                    async(toCall.bind(null, this.error_))();\r\n                    break;\r\n                default:\r\n                    triggered = false;\r\n                    break;\r\n            }\r\n            if (triggered) {\r\n                this.resolve_ = null;\r\n                this.reject_ = null;\r\n            }\r\n        }\r\n    };\r\n    UploadTask.prototype.notifyObserver_ = function (observer) {\r\n        var externalState = taskStateFromInternalTaskState(this.state_);\r\n        switch (externalState) {\r\n            case TaskState.RUNNING:\r\n            case TaskState.PAUSED:\r\n                if (observer.next) {\r\n                    async(observer.next.bind(observer, this.snapshot))();\r\n                }\r\n                break;\r\n            case TaskState.SUCCESS:\r\n                if (observer.complete) {\r\n                    async(observer.complete.bind(observer))();\r\n                }\r\n                break;\r\n            case TaskState.CANCELED:\r\n            case TaskState.ERROR:\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n                break;\r\n            default:\r\n                // TODO(andysoto): assert(false);\r\n                if (observer.error) {\r\n                    async(observer.error.bind(observer, this.error_))();\r\n                }\r\n        }\r\n    };\r\n    /**\r\n     * Resumes a paused task. Has no effect on a currently running or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.resume = function () {\r\n        validate('resume', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.PAUSED ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.RUNNING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Pauses a currently running task. Has no effect on a paused or failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.pause = function () {\r\n        validate('pause', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.PAUSING);\r\n        }\r\n        return valid;\r\n    };\r\n    /**\r\n     * Cancels a currently running or paused task. Has no effect on a complete or\r\n     * failed task.\r\n     * @return True if the operation took effect, false if ignored.\r\n     */\r\n    UploadTask.prototype.cancel = function () {\r\n        validate('cancel', [], arguments);\r\n        var valid = this.state_ === InternalTaskState.RUNNING ||\r\n            this.state_ === InternalTaskState.PAUSING;\r\n        if (valid) {\r\n            this.transition_(InternalTaskState.CANCELING);\r\n        }\r\n        return valid;\r\n    };\r\n    return UploadTask;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Provides methods to interact with a bucket in the Firebase Storage service.\r\n * @param location An fbs.location, or the URL at\r\n *     which to base this object, in one of the following forms:\r\n *         gs://<bucket>/<object-path>\r\n *         http[s]://firebasestorage.googleapis.com/\r\n *                     <api-version>/b/<bucket>/o/<object-path>\r\n *     Any query or fragment strings will be ignored in the http[s]\r\n *     format. If no value is passed, the storage object will use a URL based on\r\n *     the project ID of the base firebase.App instance.\r\n */\r\nvar Reference = /** @class */ (function () {\r\n    function Reference(service, location) {\r\n        this.service = service;\r\n        if (location instanceof Location) {\r\n            this.location = location;\r\n        }\r\n        else {\r\n            this.location = Location.makeFromUrl(location);\r\n        }\r\n    }\r\n    /**\r\n     * @return The URL for the bucket and path this object references,\r\n     *     in the form gs://<bucket>/<object-path>\r\n     * @override\r\n     */\r\n    Reference.prototype.toString = function () {\r\n        validate('toString', [], arguments);\r\n        return 'gs://' + this.location.bucket + '/' + this.location.path;\r\n    };\r\n    Reference.prototype.newRef = function (service, location) {\r\n        return new Reference(service, location);\r\n    };\r\n    Reference.prototype.mappings = function () {\r\n        return getMappings();\r\n    };\r\n    /**\r\n     * @return A reference to the object obtained by\r\n     *     appending childPath, removing any duplicate, beginning, or trailing\r\n     *     slashes.\r\n     */\r\n    Reference.prototype.child = function (childPath) {\r\n        validate('child', [stringSpec()], arguments);\r\n        var newPath = child(this.location.path, childPath);\r\n        var location = new Location(this.location.bucket, newPath);\r\n        return this.newRef(this.service, location);\r\n    };\r\n    Object.defineProperty(Reference.prototype, \"parent\", {\r\n        /**\r\n         * @return A reference to the parent of the\r\n         *     current object, or null if the current object is the root.\r\n         */\r\n        get: function () {\r\n            var newPath = parent(this.location.path);\r\n            if (newPath === null) {\r\n                return null;\r\n            }\r\n            var location = new Location(this.location.bucket, newPath);\r\n            return this.newRef(this.service, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"root\", {\r\n        /**\r\n         * @return An reference to the root of this\r\n         *     object's bucket.\r\n         */\r\n        get: function () {\r\n            var location = new Location(this.location.bucket, '');\r\n            return this.newRef(this.service, location);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"bucket\", {\r\n        get: function () {\r\n            return this.location.bucket;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"fullPath\", {\r\n        get: function () {\r\n            return this.location.path;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"name\", {\r\n        get: function () {\r\n            return lastComponent(this.location.path);\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Reference.prototype, \"storage\", {\r\n        get: function () {\r\n            return this.service;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Uploads a blob to this object's location.\r\n     * @param data The blob to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.put = function (data, metadata) {\r\n        if (metadata === void 0) { metadata = null; }\r\n        validate('put', [uploadDataSpec(), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('put');\r\n        return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data), metadata);\r\n    };\r\n    /**\r\n     * Uploads a string to this object's location.\r\n     * @param value The string to upload.\r\n     * @param format The format of the string to upload.\r\n     * @return An UploadTask that lets you control and\r\n     *     observe the upload.\r\n     */\r\n    Reference.prototype.putString = function (value, format, metadata) {\r\n        if (format === void 0) { format = StringFormat.RAW; }\r\n        validate('putString', [stringSpec(), stringSpec(formatValidator, true), metadataSpec(true)], arguments);\r\n        this.throwIfRoot_('putString');\r\n        var data = dataFromString(format, value);\r\n        var metadataClone = Object.assign({}, metadata);\r\n        if (!isDef(metadataClone['contentType']) &&\r\n            isDef(data.contentType)) {\r\n            metadataClone['contentType'] = data.contentType;\r\n        }\r\n        return new UploadTask(this, this.service, this.location, this.mappings(), new FbsBlob(data.data, true), metadataClone);\r\n    };\r\n    /**\r\n     * Deletes the object at this location.\r\n     * @return A promise that resolves if the deletion succeeds.\r\n     */\r\n    Reference.prototype.delete = function () {\r\n        var _this = this;\r\n        validate('delete', [], arguments);\r\n        this.throwIfRoot_('delete');\r\n        return this.service.getAuthToken().then(function (authToken) {\r\n            var requestInfo = deleteObject(_this.service, _this.location);\r\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * List all items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * This is a helper method for calling list() repeatedly until there are\r\n     * no more results. The default pagination size is 1000.\r\n     *\r\n     * Note: The results may not be consistent if objects are changed while this\r\n     * operation is running.\r\n     *\r\n     * Warning: listAll may potentially consume too many resources if there are\r\n     * too many results.\r\n     *\r\n     * @return A Promise that resolves with all the items and prefixes under\r\n     *      the current storage reference. `prefixes` contains references to\r\n     *      sub-directories and `items` contains references to objects in this\r\n     *      folder. `nextPageToken` is never returned.\r\n     */\r\n    Reference.prototype.listAll = function () {\r\n        validate('listAll', [], arguments);\r\n        var accumulator = {\r\n            prefixes: [],\r\n            items: []\r\n        };\r\n        return this.listAllHelper(accumulator).then(function () { return accumulator; });\r\n    };\r\n    Reference.prototype.listAllHelper = function (accumulator, pageToken) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var opt, nextPage;\r\n            var _a, _b;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        opt = {\r\n                            // maxResults is 1000 by default.\r\n                            pageToken: pageToken\r\n                        };\r\n                        return [4 /*yield*/, this.list(opt)];\r\n                    case 1:\r\n                        nextPage = _c.sent();\r\n                        (_a = accumulator.prefixes).push.apply(_a, nextPage.prefixes);\r\n                        (_b = accumulator.items).push.apply(_b, nextPage.items);\r\n                        if (!(nextPage.nextPageToken != null)) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, this.listAllHelper(accumulator, nextPage.nextPageToken)];\r\n                    case 2:\r\n                        _c.sent();\r\n                        _c.label = 3;\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * List items (files) and prefixes (folders) under this storage reference.\r\n     *\r\n     * List API is only available for Firebase Rules Version 2.\r\n     *\r\n     * GCS is a key-blob store. Firebase Storage imposes the semantic of '/'\r\n     * delimited folder structure.\r\n     * Refer to GCS's List API if you want to learn more.\r\n     *\r\n     * To adhere to Firebase Rules's Semantics, Firebase Storage does not\r\n     * support objects whose paths end with \"/\" or contain two consecutive\r\n     * \"/\"s. Firebase Storage List API will filter these unsupported objects.\r\n     * list() may fail if there are too many unsupported objects in the bucket.\r\n     *\r\n     * @param options See ListOptions for details.\r\n     * @return A Promise that resolves with the items and prefixes.\r\n     *      `prefixes` contains references to sub-folders and `items`\r\n     *      contains references to objects in this folder. `nextPageToken`\r\n     *      can be used to get the rest of the results.\r\n     */\r\n    Reference.prototype.list = function (options) {\r\n        validate('list', [listOptionSpec(true)], arguments);\r\n        var self = this;\r\n        return this.service.getAuthToken().then(function (authToken) {\r\n            var op = options || {};\r\n            var requestInfo = list(self.service, self.location, \r\n            /*delimiter= */ '/', op.pageToken, op.maxResults);\r\n            return self.service.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     *     A promise that resolves with the metadata for this object. If this\r\n     *     object doesn't exist or metadata cannot be retreived, the promise is\r\n     *     rejected.\r\n     */\r\n    Reference.prototype.getMetadata = function () {\r\n        var _this = this;\r\n        validate('getMetadata', [], arguments);\r\n        this.throwIfRoot_('getMetadata');\r\n        return this.service.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getMetadata(_this.service, _this.location, _this.mappings());\r\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * Updates the metadata for this object.\r\n     * @param metadata The new metadata for the object.\r\n     *     Only values that have been explicitly set will be changed. Explicitly\r\n     *     setting a value to null will remove the metadata.\r\n     * @return A promise that resolves\r\n     *     with the new metadata for this object.\r\n     *     @see firebaseStorage.Reference.prototype.getMetadata\r\n     */\r\n    Reference.prototype.updateMetadata = function (metadata) {\r\n        var _this = this;\r\n        validate('updateMetadata', [metadataSpec()], arguments);\r\n        this.throwIfRoot_('updateMetadata');\r\n        return this.service.getAuthToken().then(function (authToken) {\r\n            var requestInfo = updateMetadata(_this.service, _this.location, metadata, _this.mappings());\r\n            return _this.service.makeRequest(requestInfo, authToken).getPromise();\r\n        });\r\n    };\r\n    /**\r\n     * @return A promise that resolves with the download\r\n     *     URL for this object.\r\n     */\r\n    Reference.prototype.getDownloadURL = function () {\r\n        var _this = this;\r\n        validate('getDownloadURL', [], arguments);\r\n        this.throwIfRoot_('getDownloadURL');\r\n        return this.service.getAuthToken().then(function (authToken) {\r\n            var requestInfo = getDownloadUrl(_this.service, _this.location, _this.mappings());\r\n            return _this.service\r\n                .makeRequest(requestInfo, authToken)\r\n                .getPromise()\r\n                .then(function (url) {\r\n                if (url === null) {\r\n                    throw noDownloadURL();\r\n                }\r\n                return url;\r\n            });\r\n        });\r\n    };\r\n    Reference.prototype.throwIfRoot_ = function (name) {\r\n        if (this.location.path === '') {\r\n            throw invalidRootOperation(name);\r\n        }\r\n    };\r\n    return Reference;\r\n}());\n\n/**\r\n * A request whose promise always fails.\r\n * @struct\r\n * @template T\r\n */\r\nvar FailRequest = /** @class */ (function () {\r\n    function FailRequest(error) {\r\n        this.promise_ = Promise.reject(error);\r\n    }\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    FailRequest.prototype.cancel = function (_appDelete) {\r\n    };\r\n    return FailRequest;\r\n}());\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @param f May be invoked\r\n *     before the function returns.\r\n * @param callback Get all the arguments passed to the function\r\n *     passed to f, including the initial boolean.\r\n */\r\nfunction start(f, \r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ncallback, timeout) {\r\n    // TODO(andysoto): make this code cleaner (probably refactor into an actual\r\n    // type instead of a bunch of functions with state shared in the closure)\r\n    var waitSeconds = 1;\r\n    // Would type this as \"number\" but that doesn't work for Node so ¯\\_(ツ)_/¯\r\n    // TODO: find a way to exclude Node type definition for storage because storage only works in browser\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    var timeoutId = null;\r\n    var hitTimeout = false;\r\n    var cancelState = 0;\r\n    function canceled() {\r\n        return cancelState === 2;\r\n    }\r\n    var triggeredCallback = false;\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function triggerCallback() {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (!triggeredCallback) {\r\n            triggeredCallback = true;\r\n            callback.apply(null, args);\r\n        }\r\n    }\r\n    function callWithDelay(millis) {\r\n        timeoutId = setTimeout(function () {\r\n            timeoutId = null;\r\n            f(handler, canceled());\r\n        }, millis);\r\n    }\r\n    // TODO: This disable can be removed and the 'ignoreRestArgs' option added to\r\n    // the no-explicit-any rule when ESlint releases it.\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    function handler(success) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (success) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        var mustStop = canceled() || hitTimeout;\r\n        if (mustStop) {\r\n            triggerCallback.call.apply(triggerCallback, __spreadArrays([null, success], args));\r\n            return;\r\n        }\r\n        if (waitSeconds < 64) {\r\n            /* TODO(andysoto): don't back off so quickly if we know we're offline. */\r\n            waitSeconds *= 2;\r\n        }\r\n        var waitMillis;\r\n        if (cancelState === 1) {\r\n            cancelState = 2;\r\n            waitMillis = 0;\r\n        }\r\n        else {\r\n            waitMillis = (waitSeconds + Math.random()) * 1000;\r\n        }\r\n        callWithDelay(waitMillis);\r\n    }\r\n    var stopped = false;\r\n    function stop(wasTimeout) {\r\n        if (stopped) {\r\n            return;\r\n        }\r\n        stopped = true;\r\n        if (triggeredCallback) {\r\n            return;\r\n        }\r\n        if (timeoutId !== null) {\r\n            if (!wasTimeout) {\r\n                cancelState = 2;\r\n            }\r\n            clearTimeout(timeoutId);\r\n            callWithDelay(0);\r\n        }\r\n        else {\r\n            if (!wasTimeout) {\r\n                cancelState = 1;\r\n            }\r\n        }\r\n    }\r\n    callWithDelay(0);\r\n    setTimeout(function () {\r\n        hitTimeout = true;\r\n        stop(true);\r\n    }, timeout);\r\n    return stop;\r\n}\r\n/**\r\n * Stops the retry loop from repeating.\r\n * If the function is currently \"in between\" retries, it is invoked immediately\r\n * with the second parameter as \"true\". Otherwise, it will be invoked once more\r\n * after the current invocation finishes iff the current invocation would have\r\n * triggered another retry.\r\n */\r\nfunction stop(id) {\r\n    id(false);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * @struct\r\n * @template T\r\n */\r\nvar NetworkRequest = /** @class */ (function () {\r\n    function NetworkRequest(url, method, headers, body, successCodes, additionalRetryCodes, callback, errorCallback, timeout, progressCallback, pool) {\r\n        var _this = this;\r\n        this.pendingXhr_ = null;\r\n        this.backoffId_ = null;\r\n        this.canceled_ = false;\r\n        this.appDelete_ = false;\r\n        this.url_ = url;\r\n        this.method_ = method;\r\n        this.headers_ = headers;\r\n        this.body_ = body;\r\n        this.successCodes_ = successCodes.slice();\r\n        this.additionalRetryCodes_ = additionalRetryCodes.slice();\r\n        this.callback_ = callback;\r\n        this.errorCallback_ = errorCallback;\r\n        this.progressCallback_ = progressCallback;\r\n        this.timeout_ = timeout;\r\n        this.pool_ = pool;\r\n        this.promise_ = new Promise(function (resolve, reject) {\r\n            _this.resolve_ = resolve;\r\n            _this.reject_ = reject;\r\n            _this.start_();\r\n        });\r\n    }\r\n    /**\r\n     * Actually starts the retry loop.\r\n     */\r\n    NetworkRequest.prototype.start_ = function () {\r\n        var self = this;\r\n        function doTheRequest(backoffCallback, canceled) {\r\n            if (canceled) {\r\n                backoffCallback(false, new RequestEndStatus(false, null, true));\r\n                return;\r\n            }\r\n            var xhr = self.pool_.createXhrIo();\r\n            self.pendingXhr_ = xhr;\r\n            function progressListener(progressEvent) {\r\n                var loaded = progressEvent.loaded;\r\n                var total = progressEvent.lengthComputable ? progressEvent.total : -1;\r\n                if (self.progressCallback_ !== null) {\r\n                    self.progressCallback_(loaded, total);\r\n                }\r\n            }\r\n            if (self.progressCallback_ !== null) {\r\n                xhr.addUploadProgressListener(progressListener);\r\n            }\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            xhr\r\n                .send(self.url_, self.method_, self.body_, self.headers_)\r\n                .then(function (xhr) {\r\n                if (self.progressCallback_ !== null) {\r\n                    xhr.removeUploadProgressListener(progressListener);\r\n                }\r\n                self.pendingXhr_ = null;\r\n                xhr = xhr;\r\n                var hitServer = xhr.getErrorCode() === ErrorCode.NO_ERROR;\r\n                var status = xhr.getStatus();\r\n                if (!hitServer || self.isRetryStatusCode_(status)) {\r\n                    var wasCanceled = xhr.getErrorCode() === ErrorCode.ABORT;\r\n                    backoffCallback(false, new RequestEndStatus(false, null, wasCanceled));\r\n                    return;\r\n                }\r\n                var successCode = self.successCodes_.indexOf(status) !== -1;\r\n                backoffCallback(true, new RequestEndStatus(successCode, xhr));\r\n            });\r\n        }\r\n        /**\r\n         * @param requestWentThrough True if the request eventually went\r\n         *     through, false if it hit the retry limit or was canceled.\r\n         */\r\n        function backoffDone(requestWentThrough, status) {\r\n            var resolve = self.resolve_;\r\n            var reject = self.reject_;\r\n            var xhr = status.xhr;\r\n            if (status.wasSuccessCode) {\r\n                try {\r\n                    var result = self.callback_(xhr, xhr.getResponseText());\r\n                    if (isJustDef(result)) {\r\n                        resolve(result);\r\n                    }\r\n                    else {\r\n                        resolve();\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }\r\n            else {\r\n                if (xhr !== null) {\r\n                    var err = unknown();\r\n                    err.setServerResponseProp(xhr.getResponseText());\r\n                    if (self.errorCallback_) {\r\n                        reject(self.errorCallback_(xhr, err));\r\n                    }\r\n                    else {\r\n                        reject(err);\r\n                    }\r\n                }\r\n                else {\r\n                    if (status.canceled) {\r\n                        var err = self.appDelete_ ? appDeleted() : canceled();\r\n                        reject(err);\r\n                    }\r\n                    else {\r\n                        var err = retryLimitExceeded();\r\n                        reject(err);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (this.canceled_) {\r\n            backoffDone(false, new RequestEndStatus(false, null, true));\r\n        }\r\n        else {\r\n            this.backoffId_ = start(doTheRequest, backoffDone, this.timeout_);\r\n        }\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.getPromise = function () {\r\n        return this.promise_;\r\n    };\r\n    /** @inheritDoc */\r\n    NetworkRequest.prototype.cancel = function (appDelete) {\r\n        this.canceled_ = true;\r\n        this.appDelete_ = appDelete || false;\r\n        if (this.backoffId_ !== null) {\r\n            stop(this.backoffId_);\r\n        }\r\n        if (this.pendingXhr_ !== null) {\r\n            this.pendingXhr_.abort();\r\n        }\r\n    };\r\n    NetworkRequest.prototype.isRetryStatusCode_ = function (status) {\r\n        // The codes for which to retry came from this page:\r\n        // https://cloud.google.com/storage/docs/exponential-backoff\r\n        var isFiveHundredCode = status >= 500 && status < 600;\r\n        var extraRetryCodes = [\r\n            // Request Timeout: web server didn't receive full request in time.\r\n            408,\r\n            // Too Many Requests: you're getting rate-limited, basically.\r\n            429\r\n        ];\r\n        var isExtraRetryCode = extraRetryCodes.indexOf(status) !== -1;\r\n        var isRequestSpecificRetryCode = this.additionalRetryCodes_.indexOf(status) !== -1;\r\n        return isFiveHundredCode || isExtraRetryCode || isRequestSpecificRetryCode;\r\n    };\r\n    return NetworkRequest;\r\n}());\r\n/**\r\n * A collection of information about the result of a network request.\r\n * @param opt_canceled Defaults to false.\r\n * @struct\r\n */\r\nvar RequestEndStatus = /** @class */ (function () {\r\n    function RequestEndStatus(wasSuccessCode, xhr, canceled) {\r\n        this.wasSuccessCode = wasSuccessCode;\r\n        this.xhr = xhr;\r\n        this.canceled = !!canceled;\r\n    }\r\n    return RequestEndStatus;\r\n}());\r\nfunction addAuthHeader_(headers, authToken) {\r\n    if (authToken !== null && authToken.length > 0) {\r\n        headers['Authorization'] = 'Firebase ' + authToken;\r\n    }\r\n}\r\nfunction addVersionHeader_(headers) {\r\n    var version = typeof firebase !== 'undefined' ? firebase.SDK_VERSION : 'AppManager';\r\n    headers['X-Firebase-Storage-Version'] = 'webjs/' + version;\r\n}\r\nfunction addGmpidHeader_(headers, appId) {\r\n    if (appId) {\r\n        headers['X-Firebase-GMPID'] = appId;\r\n    }\r\n}\r\n/**\r\n * @template T\r\n */\r\nfunction makeRequest(requestInfo, appId, authToken, pool) {\r\n    var queryPart = makeQueryString(requestInfo.urlParams);\r\n    var url = requestInfo.url + queryPart;\r\n    var headers = Object.assign({}, requestInfo.headers);\r\n    addGmpidHeader_(headers, appId);\r\n    addAuthHeader_(headers, authToken);\r\n    addVersionHeader_(headers);\r\n    return new NetworkRequest(url, requestInfo.method, headers, requestInfo.body, requestInfo.successCodes, requestInfo.additionalRetryCodes, requestInfo.handler, requestInfo.errorHandler, requestInfo.timeout, requestInfo.progressCallback, pool);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * A service that provides firebaseStorage.Reference instances.\r\n * @param opt_url gs:// url to a custom Storage Bucket\r\n *\r\n * @struct\r\n */\r\nvar StorageService = /** @class */ (function () {\r\n    function StorageService(app, authProvider, pool, url) {\r\n        var _a;\r\n        this.bucket_ = null;\r\n        this.appId_ = null;\r\n        this.deleted_ = false;\r\n        this.app_ = app;\r\n        this.authProvider_ = authProvider;\r\n        this.maxOperationRetryTime_ = DEFAULT_MAX_OPERATION_RETRY_TIME;\r\n        this.maxUploadRetryTime_ = DEFAULT_MAX_UPLOAD_RETRY_TIME;\r\n        this.requests_ = new Set();\r\n        this.pool_ = pool;\r\n        if (url != null) {\r\n            this.bucket_ = Location.makeFromBucketSpec(url);\r\n        }\r\n        else {\r\n            this.bucket_ = StorageService.extractBucket_((_a = this.app_) === null || _a === void 0 ? void 0 : _a.options);\r\n        }\r\n        this.internals_ = new ServiceInternals(this);\r\n    }\r\n    StorageService.extractBucket_ = function (config) {\r\n        var bucketString = config === null || config === void 0 ? void 0 : config[CONFIG_STORAGE_BUCKET_KEY];\r\n        if (bucketString == null) {\r\n            return null;\r\n        }\r\n        return Location.makeFromBucketSpec(bucketString);\r\n    };\r\n    StorageService.prototype.getAuthToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var auth, tokenData;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        auth = this.authProvider_.getImmediate({ optional: true });\r\n                        if (!auth) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, auth.getToken()];\r\n                    case 1:\r\n                        tokenData = _a.sent();\r\n                        if (tokenData !== null) {\r\n                            return [2 /*return*/, tokenData.accessToken];\r\n                        }\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/, null];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Stop running requests and prevent more from being created.\r\n     */\r\n    StorageService.prototype.deleteApp = function () {\r\n        this.deleted_ = true;\r\n        this.app_ = null;\r\n        this.requests_.forEach(function (request) { return request.cancel(); });\r\n        this.requests_.clear();\r\n    };\r\n    /**\r\n     * Returns a new firebaseStorage.Reference object referencing this StorageService\r\n     * at the given Location.\r\n     * @param loc The Location.\r\n     * @return A firebaseStorage.Reference.\r\n     */\r\n    StorageService.prototype.makeStorageReference = function (loc) {\r\n        return new Reference(this, loc);\r\n    };\r\n    StorageService.prototype.makeRequest = function (requestInfo, authToken) {\r\n        var _this = this;\r\n        if (!this.deleted_) {\r\n            var request_1 = makeRequest(requestInfo, this.appId_, authToken, this.pool_);\r\n            this.requests_.add(request_1);\r\n            // Request removes itself from set when complete.\r\n            request_1.getPromise().then(function () { return _this.requests_.delete(request_1); }, function () { return _this.requests_.delete(request_1); });\r\n            return request_1;\r\n        }\r\n        else {\r\n            return new FailRequest(appDeleted());\r\n        }\r\n    };\r\n    /**\r\n     * Returns a firebaseStorage.Reference for the given path in the default\r\n     * bucket.\r\n     */\r\n    StorageService.prototype.ref = function (path) {\r\n        function validator(path) {\r\n            if (typeof path !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (/^[A-Za-z]+:\\/\\//.test(path)) {\r\n                throw 'Expected child path but got a URL, use refFromURL instead.';\r\n            }\r\n        }\r\n        validate('ref', [stringSpec(validator, true)], arguments);\r\n        if (this.bucket_ == null) {\r\n            throw new Error('No Storage Bucket defined in Firebase Options.');\r\n        }\r\n        var ref = new Reference(this, this.bucket_);\r\n        if (path != null) {\r\n            return ref.child(path);\r\n        }\r\n        else {\r\n            return ref;\r\n        }\r\n    };\r\n    /**\r\n     * Returns a firebaseStorage.Reference object for the given absolute URL,\r\n     * which must be a gs:// or http[s]:// URL.\r\n     */\r\n    StorageService.prototype.refFromURL = function (url) {\r\n        function validator(p) {\r\n            if (typeof p !== 'string') {\r\n                throw 'Path is not a string.';\r\n            }\r\n            if (!/^[A-Za-z]+:\\/\\//.test(p)) {\r\n                throw 'Expected full URL but got a child path, use ref instead.';\r\n            }\r\n            try {\r\n                Location.makeFromUrl(p);\r\n            }\r\n            catch (e) {\r\n                throw 'Expected valid full URL but got an invalid one.';\r\n            }\r\n        }\r\n        validate('refFromURL', [stringSpec(validator, false)], arguments);\r\n        return new Reference(this, url);\r\n    };\r\n    Object.defineProperty(StorageService.prototype, \"maxUploadRetryTime\", {\r\n        get: function () {\r\n            return this.maxUploadRetryTime_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StorageService.prototype.setMaxUploadRetryTime = function (time) {\r\n        validate('setMaxUploadRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.maxUploadRetryTime_ = time;\r\n    };\r\n    Object.defineProperty(StorageService.prototype, \"maxOperationRetryTime\", {\r\n        get: function () {\r\n            return this.maxOperationRetryTime_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    StorageService.prototype.setMaxOperationRetryTime = function (time) {\r\n        validate('setMaxOperationRetryTime', [nonNegativeNumberSpec()], arguments);\r\n        this.maxOperationRetryTime_ = time;\r\n    };\r\n    Object.defineProperty(StorageService.prototype, \"app\", {\r\n        get: function () {\r\n            return this.app_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(StorageService.prototype, \"INTERNAL\", {\r\n        get: function () {\r\n            return this.internals_;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    return StorageService;\r\n}());\r\n/**\r\n * @struct\r\n */\r\nvar ServiceInternals = /** @class */ (function () {\r\n    function ServiceInternals(service) {\r\n        this.service_ = service;\r\n    }\r\n    /**\r\n     * Called when the associated app is deleted.\r\n     */\r\n    ServiceInternals.prototype.delete = function () {\r\n        this.service_.deleteApp();\r\n        return Promise.resolve();\r\n    };\r\n    return ServiceInternals;\r\n}());\n\nvar name = \"@firebase/storage\";\nvar version = \"0.3.43\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Type constant for Firebase Storage.\r\n */\r\nvar STORAGE_TYPE = 'storage';\r\nfunction factory(container, url) {\r\n    // Dependencies\r\n    var app = container.getProvider('app').getImmediate();\r\n    var authProvider = container.getProvider('auth-internal');\r\n    return new StorageService(app, authProvider, new XhrIoPool(), url);\r\n}\r\nfunction registerStorage(instance) {\r\n    var namespaceExports = {\r\n        // no-inline\r\n        TaskState: TaskState,\r\n        TaskEvent: TaskEvent,\r\n        StringFormat: StringFormat,\r\n        Storage: StorageService,\r\n        Reference: Reference\r\n    };\r\n    instance.INTERNAL.registerComponent(new Component(STORAGE_TYPE, factory, \"PUBLIC\" /* PUBLIC */)\r\n        .setServiceProps(namespaceExports)\r\n        .setMultipleInstances(true));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterStorage(firebase);\n\nexport { registerStorage };\n"]},"metadata":{},"sourceType":"module"}